/*By 任龙飞—renlongfei*/
var height=$(window).height(),push_stu=0;$(".body-left").css({height:height});var pic,pic_zhu,maxFileCount1=0,maxFileCount2=0,invoice_type="无",All=[];"8"!==token&&(maxFileCount1=5,maxFileCount2=10);function arrow_show(n,i,t){switch(i){case"mouseover":var l=0;break;case"mouseleave":l="-20px"}$(n).on(i,t,function(){$(this).find(".last").stop(!0).animate({left:l},300),$(this).find(".next").stop(!0).animate({right:l},300)})}function ArrChange(n,i,t){switch(n){case 0:t>0&&(i.splice(t-1,0,i[t]),i.splice(t+1,1));break;case 1:t<i.length-1&&(i.splice(t+2,0,i[t]),i.splice(t,1))}}$.post(localhost+"/tuan/types/list",{saleId:token,online_code:onlinecode},function(n){if(outline(n),null!==n.data){for(var i=-1===n.data.types.indexOf(",")?[n.data.types]:n.data.types.split(","),t=0;t<i.length;t++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+i[t]+"</span></div>");arrow_show(".span","mouseover",".span-span"),arrow_show(".span","mouseleave",".span-span"),$(".span").on("click",".last",function(){var n=$(this).parents(".span-span").index();ArrChange(0,i,n),$(".span").html("");for(var t=0;t<i.length;t++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+i[t]+"</span></div>");return!1}),$(".span").on("click",".next",function(){var n=$(this).parents(".span-span").index();ArrChange(1,i,n),$(".span").html("");for(var t=0;t<i.length;t++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+i[t]+"</span></div>");return!1}),$(".button").click(function(){$.post(localhost+"/tuan/types/update",{saleId:token,typenames:i.join(","),online_code:onlinecode},function(n){console.log(n)})})}}),$.post(localhost+"/tuan/tdelivertemplates/list",{saleId:token,online_code:onlinecode},function(n){outline(n);for(var i=n.data,t=0;t<i.length;t++)$("select").append("<option>"+i[t].dname+'<div class="deliverid" style=" display: none">='+i[t].id+"</div></option>")}),$("body").on("blur",".chima",function(){$(this).addClass("transform")}),$(".span").on("click",".span-span",function(){$(".span").siblings(".classify").find("input").val($(this).find("span").text())}),$("body").on("click",".clickdb",function(){$(this).prop("readonly",!1)}),$("body").on("blur",".clickdb",function(){$(this).prop("readonly",!0)}),$("body").on("click",".del",function(){$(".del").length>1&&$(this).parents(".all").remove()}),$("body").on("click",".del_",function(){$(this).parents(".all-con-right").find(".push-details").length>1&&$(this).parents(".push-details").parents("li").remove()}),$("body").on("click",".all-top .jia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .jia",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".jiage").val(n)}),$("body").on("click",".all-top .djia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .djia",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".djiage").val(n)}),$("body").on("click",".all-top .pjia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .pjia",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".pjiage").val(n)}),$("body").on("click",".all-top .cunliang",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .cunliang",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".nums").val(n)}),$("body").on("click",".add_",function(){$(this).siblings("ul").append('<li>\n<ul class="push-details">\n<li><span>\n<input type="text" placeholder=\'列如："S"\' class="chima">\n</span></li>\n<li><input type="text" readonly class="clickdb jiage"></li><li><input type="text" readonly class="clickdb djiage"></li><li><input type="text" readonly class="clickdb pjiage"></li> <li><input type="text" readonly class="clickdb nums"></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>')}),$(".add").click(function(){$(".sure").append('<div class="all">\n                <div class="all-top">\n                    <ul>\n                        <li style="width: 90px">颜色</li>\n                        <li>尺码</li>\n<li style="position: relative" class="jia"><span style="cursor: pointer">原价<span style="font-size: 12px;display: block">(双击一键添加)</span></span><input type="text" style="height: 100%;width: 64%;position: absolute;left:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center"></li>                        <li style="position: relative" class="djia">\n                            <span style="cursor: pointer;display: block">单独价\n                                <span style="font-size: 12px;display: block">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n<li style="position: relative" class="pjia">\n                            <span style="cursor: pointer;display: block">拼单价\n                                <span style="font-size: 12px;display: block">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                        <li style="position: relative" class="cunliang">\n                            <span>库存\n                                <span style="font-size: 12px;display: block">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                    </ul>\n                </div>\n                <div class="all-con">\n                    <div class="all-con-left">\n                        <input type="text"  readonly class="clickdb">\n                    </div>\n                    <div class="all-con-right">\n                        <ul>\n<li>\n                                <ul class="push-details">\n                                    <li><span>\n                                      <input type="text" placeholder=\'列如："S"\' class="chima">\n                                </span></li>\n                <li><input type="text" readonly class="clickdb jiage"></li>                <li><input type="text" readonly class="clickdb djiage"></li><li><input type="text" readonly class="clickdb pjiage"></li> <li><input type="text" readonly class="clickdb nums"></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>                        </ul>\n<div class="add_"><img src="images/add.png" alt=""></div>                    </div>\n                    <div class="del">\n                        <img src="images/del.png" alt="">\n                    </div>\n                </div>\n            </div>')}),$(".sure").on("input","input",function(){All=[],$(".button").html("保存")}),$(".button").click(function(){var n=!0;if($(".sure").find(".all-con-left input").each(function(i,t){""===t.value&&(alert("有颜色栏未填写，如不需要请点击右上角删除！"),n=!1)}),!0!==n)return!1;if($(".sure").find(".all-con-right span input").each(function(i,t){""===t.value&&(alert("有尺寸栏未填写，如不需要请点击右上角删除！"),n=!1)}),!0!==n)return!1;All=[];for(var i=0,t=0;t<$(".disjiage").length;t++)$(".disjiage").eq(t).val()<=0&&i++;if(i>0)return alert("折扣价不得为0！"),!1;for(var l=0;l<$(".all-con-right").find("input").length;l++)""===$(".all-con-right").find("input").eq(l).val()&&i++;if(i>0){if(!confirm("你所填写的信息中有空白，点击确定自动补全为0或填写完整！"))return!1;for(l=0;l<$(".all-con-right").find("input").length;l++)""==$(".all-con-right").find("input").eq(l).val()&&$(".all-con-right").find("input").eq(l).val("0")}for(var a=0;a<$(".all-con-left").length;a++)for(var e=0;e<$(".all-con-right").eq(a).find(".push-details input").length;e+=5)All.push($(".all-con-left").find("input").eq(a).val()+","+$(".all-con-right").eq(a).find("input").eq(e).val()+","+$(".all-con-right").eq(a).find("input").eq(e+1).val()+","+$(".all-con-right").eq(a).find("input").eq(e+2).val()+","+$(".all-con-right").eq(a).find("input").eq(e+3).val()+","+$(".all-con-right").eq(a).find("input").eq(e+4).val());$(".button").html("已保存！")}),$("#loading").fileinput({language:"zh",uploadUrl:localhost+"/tuan/product/uploadPic",allowedFileExtensions:["jpg","png","gif"],maxFileCount:maxFileCount1,enctype:"multipart/form-data",showUpload:!0,showCaption:!1,uploadAsync:!1,browseClass:"btn btn-primary",previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadExtraData:function(n,i){var t={};return t.saleId=token,t.online_code=onlinecode,t}}).on("filebatchuploadsuccess",function(n,i){""===i.response.data&&void 0===i.response.data||(pic_zhu=i.response.data)}),$("#uploading").fileinput({language:"zh",uploadUrl:localhost+"/tuan/product/uploadPic",allowedFileExtensions:["jpg","png","gif"],maxFileCount:maxFileCount2,enctype:"multipart/form-data",showUpload:!0,showCaption:!1,uploadAsync:!1,browseClass:"btn btn-primary",previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadExtraData:function(n,i){var t={};return t.saleId=token,t.online_code=onlinecode,t}}).on("filebatchuploadsuccess",function(n,i){if(""!==i.response.data||void 0!==i.response.data)for(var t=(pic=i.response.data).split(","),l=0;l<t.length;l++)$(".preview-con").append('<img src="'+t[l]+'" alt="" width="100%">')}),$(".classify").find("input").on("input",function(){});var deliverPrice="";$(".express").click(function(){$(this).is(":checked")?(deliverPrice=null,$("select").val("选择快递模板")):deliverPrice=$("select option:selected").html().split("=")[1]}),$("select").click(function(){"选择快递模板"===$("select option:selected").text()?(deliverPrice=null,$(".express").prop("checked",!0)):(deliverPrice=$("select option:selected").html().split("=")[1],$(".express").prop("checked",!1))}),$('input[type="number"]').blur(function(){var n=parseInt($(this).val());if("NaN"===n.toString())return alert("你输入的格式有误！"),$(this).val("0"),!1;n<0&&$(this).val("0")}),$(".fabu").click(function(){var n=pic,i=pic_zhu,t=$(".title").find("input").val(),l=$(".classify").find("input").val(),a=$(".kuanhao").find("input").val(),e=$(".tjbianji").find("input").val(),s=($(".address .input textarea").val(),$(".kuaidi").eq(1).find("input:checked").siblings("span").html(),$(".canshu").find("input").eq(0).val(),$(".canshu").find("input").eq(1).val(),$(".canshu").find("input").eq(3).val(),$(".canshu").find("input").eq(4).val(),$(".canshu").find("input").eq(5).val(),$(".canshu").find("input").eq(6).val(),$(".canshu textarea").val()),p=""===$(".pdan-num input").val()?0:$(".pdan-num input").val(),o=""===$(".pdan-time input").val()?0:$(".pdan-time input").val(),c=$(".pdan-start input").eq(0).val()+" "+$(".pdan-start input").eq(1).val()+":"+$(".pdan-start input").eq(2).val(),d=$(".pdan-end input").eq(0).val()+" "+$(".pdan-end input").eq(1).val()+":"+$(".pdan-end input").eq(2).val();return""===t||""===l||""===deliverPrice||"选择快递模板"===deliverPrice||""===$(".pdan-start input").eq(1).val()||""===$(".pdan-end input").eq(1).val()||""===$(".pdan-start input").eq(2).val()||""===$(".pdan-end input").eq(2).val()?(alert("标题，分类，快递模板，拼团开始时间，拼团结束时间为必填项！"),!1):void 0===n||void 0===i?(alert("请先上传图片！"),!1):0===All.length?(alert("请先点击保存按钮！"),!1):$(".pdan-start input").eq(1).val()-0>=24||$(".pdan-end input").eq(1).val()-0>=24||$(".pdan-start input").eq(2).val()-0>=60||$(".pdan-end input").eq(2).val()-0>=60?(alert("时间有误!时间格式为24小时制"),!1):void(0===push_stu&&(push_stu=1,$.post(localhost+"/tuan/product/save",{pname:t,types:l,deliver:deliverPrice,style:a,detailPic:n,indexPic:i,tprotypes:All.join("="),saleId:token,online_code:onlinecode,parameters:s,tuanNumbers:p,tuanTimes:o,start_date:c,end_date:d,suffix:e},function(n){outline(n),"操作成功"===n.message?(alert("添加成功！"),push_stu=0,location.href="push_pin.html"):(alert(n.message),push_stu=0)})))});
/*2018-01-08*/