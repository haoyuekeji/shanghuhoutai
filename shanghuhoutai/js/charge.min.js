/*By 任龙飞—renlongfei*/
var content,style,details,html_,amount_=[],saleNumber_=[],pages=0,pagesindex=0,showlist=[],enlist=[],dename=[],nums=0;"0"===authority&&($(".body-top ul li:gt(0)").css({display:"none"}),$(".body-top ul").css({background:"#18cffb"})),$("body").on("click",".edit",function(){""===$(this).attr("title")?($(this).siblings(".details-details").stop(!0).slideDown(),$(this).prop("title","编辑")):($(this).siblings(".details-details").stop(!0).slideUp(),$(this).prop("title",""))});function addhtml_(s){$(".all").html(""),$(".pages").show();for(var e=s.length-1;e>=0;e--){!1===s[e].active&&s.splice(e,1);for(var n=s[e].produtsTypes.length-1;n>=0;n--)!1===s[e].produtsTypes[n].active&&s[e].produtsTypes.splice(n,1),0===s[e].produtsTypes.length&&s.splice(e,1)}if(0===s.length)return $(".all").html('您没有发布任何商品！<a href="push.html" style="color:red">点击发布</a>'),!1;for(var t=0;t<s.length;t++){var a=0,i=s[t].indexImages.split(",");s[t].produtsTypes.forEach(function(s,e){a+=s.amount}),amount_.push(a),saleNumber_=null===s[t].monthSale?0:s[t].monthSale,$(".all").append('<div class="details">\n                <div class="details-left">\n                    <img src="'+i[0]+'" alt="">\n                </div>\n                <div class="details-con">\n                    <div class="details-con-top">\n'+s[t].pname+'                    </div>\n                    <div class="init">   </div>\n                    <div class="price">\n<div class="produt-id" style="display:none">商品编号：<span>'+s[t].id+'</span></div><div style="color:red">商品编号：<span style="color:red">'+s[t].pcode+'</span></div>                        <span class="nums">\n                            剩余库存：'+amount_[t]+"&nbsp&nbsp&nbsp\n                            已卖出："+saleNumber_+'\n                        </span>\n                    </div>                </div>\n                <div class="edit" title="">编辑</div>\n                <div class="down" title="">下架</div>\n                <div class="fix" title="">修改</div>\n                <div class="shopcar-count" title="">已加购物车人数：'+s[t].shopcar_count+'</div>\n\n                <div class="details-details">\n                    <div class="">\n                        <span>颜色</span>\n                        <span>尺码</span>\n                        <span>单价</span>\n                        <span>修改单价</span>\n                        <span>库存</span>\n                        <span>增加库存</span>\n                        <span>下架</span>\n                    </div>\n                </div>\n            </div>');for(var l=0;l<s[t].produtsTypes.length;l++)$(".details-details").eq(t).append('<div class="list">\n<span>'+s[t].produtsTypes[l].color+"</span>\n<span>"+s[t].produtsTypes[l].size+"</span>\n<span>"+s[t].produtsTypes[l].discountPrice+'</span>\n<span><span class="id" style="display: none">'+s[t].produtsTypes[l].id+'</span><input type="text"><span class="sure-price">确定</span></span>\n<span>'+s[t].produtsTypes[l].amount+'</span>\n<span><span class="id" style="display: none">'+s[t].produtsTypes[l].id+'</span><input type="text"><span class="sure-nums">确定</span></span>\n<span class="del"><span class="id" style="display: none">'+s[t].produtsTypes[l].id+'</span><span class="id_id" style="display: none">'+s[t].id+"</span>下架</span> </div>\n")}}function addhtml4_(s){if($(".all").html(""),$(".pages").show(),$("body").append("<script src='js/times.min.js'><\/script>"),0===s.length)return $(".all").html("您没有已下架商品！"),!1;for(var e=0;e<s.length;e++){var n=0;if(0===s.length)return $(".all").html("暂无商品！"),!1;var t=new Date;Date.parse(s[e].showDate)>Date.parse(t)?console.log(1):console.log(2);var a=s[e].indexImages.split(",");s[e].produtsTypes.forEach(function(s,e){n+=s.amount}),amount_.push(n),saleNumber_=null===s[e].monthSale?0:s[e].monthSale,$(".all").append('<div class="details">\n<div class="id_id" style="display: none">'+s[e].id+'</div>                <div class="details-left">\n                    <img src="'+a[0]+'" alt="">\n                </div>\n                <div class="details-con">\n                    <div class="details-con-top">\n'+s[e].pname+'                    </div>\n                    <div class="init">   </div>\n                    <div class="price">\n<div class="produt-id" style="display:none">商品编号：<span>'+s[e].id+'</span></div><div style="color:red">商品编号：<span style="color:red">'+s[e].pcode+'</span></div>                        <span class="nums">\n                            剩余库存：'+amount_[e]+"&nbsp&nbsp&nbsp\n                            已卖出："+saleNumber_+'\n                        </span>\n                    </div>                </div>\n                <div class="edit" title="">编辑</div>\n                <div class="shangjia" title="">上架</div>\n                <div class="fix" title="">修改</div>\n\n                <div class="details-details">\n                    <div class="">\n                        <span>颜色</span>\n                        <span>尺码</span>\n                        <span>单价</span>\n                        <span>修改单价</span>\n                        <span>库存</span>\n                        <span>增加库存</span>\n                    </div>\n                </div>\n            <div class="details-times"  endTime="'+s[e].showDate+'">            </div>            </div>');for(var i=0;i<s[e].produtsTypes.length;i++)$(".details-details").eq(e).append('<div class="list">\n<span>'+s[e].produtsTypes[i].color+"</span>\n<span>"+s[e].produtsTypes[i].size+"</span>\n<span>"+s[e].produtsTypes[i].discountPrice+'</span>\n<span><span class="id" style="display: none">'+s[e].produtsTypes[i].id+'</span><input type="text"><span class="sure-price">确定</span></span>\n<span>'+s[e].produtsTypes[i].amount+'</span>\n<span><span class="id" style="display: none">'+s[e].produtsTypes[i].id+'</span><input type="text"><span class="sure-nums">确定</span></span>\n<span class="del" style="display: none"><span class="id" style="display: none">'+s[e].produtsTypes[i].id+'</span><span class="id_id" style="display: none">'+s[e].id+"</span>下架</span> </div>\n")}}$(".body-top ul li").click(function(){var s=$(this).index();switch(pagesindex=$(this).index(),pages=0,$(".all").html(""),s){case 0:$.post(localhost+"/shopCar/shopcar_by_pro",{pageNumber:pages,pageSize:10,sellerId:token,active:!0,online_code:onlinecode},function(s){outline(s);var e=s.data;addhtml_(e),0===e.length?$(".pages").hide():$(".pages").show()});break;case 1:$.post(localhost+"/seller/pro/list",{pageNumber:pages,pageSize:10,token:token,active:!1,online_code:onlinecode},function(s){outline(s);var e=s.data.content;addhtml4_(e),0===e.length?$(".pages").hide():$(".pages").show()})}}),$.post(localhost+"/shopCar/shopcar_by_pro",{sellerId:token,active:!0,online_code:onlinecode},function(s){outline(s);var e=s.data;nums=s.token-0,0===e.length&&$(".pages").hide(),addhtml_(e)}),$("body").on("click",".sure-price",function(){var s=$(this).siblings("input").val();if(""!==s&&/^\d{0,8}\.{0,1}(\d{1,2})?$/.test(s)){var e=$(this).siblings("input").val(),n=$(this).siblings(".id").html(),t=$(this).parents(".details").find(".id_id").html(),a=$(this);$.post(localhost+"/seller/pro/update",{token:token,ptypeId:n,pid:t,discount:e,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message?(a.parents("span").siblings("span").eq(2).html(e),a.siblings("input").val("")):alert("未修改成功！")})}}),$("body").on("click",".sure-nums",function(){var s=$(this).siblings("input").val();if(""!==s){var e=$(this).siblings(".id").html(),n=$(this);$.post(localhost+"/protype/update",{token:token,id:e,amount:s,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message?(n.parents("span").siblings("span").eq(4).html(s),n.siblings("input").val("")):alert("未修改成功！")})}}),$("body").on("click",".del",function(){if(""!==$(this).siblings("input")){var s=$(this).find(".id").html(),e=$(this).find(".id_id").html(),n=$(this).parents(".list").index()-1,t=$(this).parents().parents().parents().index();$.post(localhost+"/seller/pro/update",{token:token,protypeId:s,pid:e,downptype:"downptype",online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(t).find(".list").eq(n).remove(),0===$(".details").eq(t).find(".del").length&&$.post(localhost+"/seller/pro/update",{token:token,pid:e,downpro:"downpro",online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(t).remove()}),0===$(".details").length&&$(".pages").hide()})}}),$("body").on("click",".down",function(){var s=$(this).parents(".details").find(".produt-id span").text(),e=$(this).parents(".details").index();$.post(localhost+"/seller/pro/update",{token:token,pid:s,downpro:"downpro",online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(e).remove()})}),$("body").on("click",".fix",function(){var s=$(this).parents(".details").find(".produt-id span").text();localStorage.setItem("fix",s),location.href="fix.html"}),$("body").on("click",".shangjia",function(){var s=$(this).parents(".details").find(".produt-id span").text(),e=$(this);$.post(localhost+"/seller/pro/update",{token:token,pid:s,active_pro:"active_pro",online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&(alert("上架成功！"),e.parents(".details").remove())})}),$(".next").click(function(){if(pages++,0===pagesindex&&pages===nums)return $(".message").html("这已经是最后一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3),pages--,!1;switch(pagesindex){case 0:style="/shopCar/shopcar_by_pro",details={pageNumber:pages,pageSize:10,sellerId:token,active:!0,online_code:onlinecode},html_=addhtml_;break;case 1:style="/seller/pro/list",details={pageNumber:pages,pageSize:10,token:token,active:!1,online_code:onlinecode},html_=addhtml4_}$.post(localhost+style,details,function(s){if(outline(s),0===(content=0===pagesindex?s.data:s.data.content).length){switch($(".message").html("这已经是最后一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3),pages--,pagesindex){case 0:style="/shopCar/shopcar_by_pro",details={pageNumber:pages,pageSize:10,sellerId:token,active:!0,online_code:onlinecode},html_=addhtml_;break;case 1:style="/seller/pro/list",details={pageNumber:pages,pageSize:10,token:token,active:!1,online_code:onlinecode},html_=addhtml4_}$.post(localhost+style,details,function(s){outline(s),content=s.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()})}else content=0===pagesindex?s.data:s.data.content,html_(content)})}),$(".last").click(function(){if(--pages<0)pages=0,$(".message").html("这已经是第一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3);else{switch(pagesindex){case 0:style="/shopCar/shopcar_by_pro",details={pageNumber:pages,pageSize:10,sellerId:token,active:!0,online_code:onlinecode},html_=addhtml_;break;case 1:style="/seller/pro/list",details={pageNumber:pages,pageSize:10,token:token,active:!1,online_code:onlinecode},html_=addhtml4_}$.post(localhost+style,details,function(s){outline(s),content=0===pagesindex?s.data:s.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()})}});
/*2018-01-04*/