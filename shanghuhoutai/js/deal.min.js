/*By 任龙飞—renlongfei*/
function addhtml1_(e){if($(".all").html(""),0===e.length)return $(".all").html("您没有未付款订单！"),!1;$(".all").append('<div class="dBtn"><div class="allInput"><input type="checkbox" id="zongBox"><label for="zongBox">全选</label></div><div class="searchInput">查询订单</div><div class="btnEcl">生成表格</div></div>');for(var s=0;s<e.length;s++){var l=e[s].products[0].indexImages.split(",")[0];inputIndex.push(e[s].id);var t="";console.log(),inputEcl.forEach(function(l,a){l==e[s].id&&(t="checked")}),$(".all").append('<div class="details">\n<div class="data"><input type="checkbox" class="inputBox" value="'+e[s].id+'" '+t+"><a> 订单号："+e[s].orderCode+"</a><span>成交时间："+e[s].createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+l+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n'+e[s].products[0].pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+e[s].produtsTypes[0].color+'</span>\n<span class="chima">尺码：'+e[s].produtsTypes[0].size+'</span>\n</div>\n<div class="price price-charge">\n标价：￥<span style="color:black;">'+e[s].produtsTypes[0].discountPrice+'<span style="color:black;margin-left:30px">总价：￥<span class="price-all" style="color:black;">'+e[s].totalPrice+'</span> </span></div>\n</div>\n<div class="details-right-charge" style="width:50%">\n    <div class="address" style="width:45%">\n'+e[s].address.receiver+e[s].address.phone+"<br>\n"+e[s].address.address+'</div>\n<div class="id" style="display:none">'+e[s].id+'</div><div class="fahuo revise-price" title="">\n修改单价\n</div>\n<div class="fahuo cacel-price" title="" style="right:150px">\n关闭订单\n</div>\n</div>\n    </div>')}}function addhtml2_(e){if($(".all").html(""),0===e.length)return $(".all").html("您没有已发货订单！"),!1;$(".all").append('<div class="dBtn"><div class="allInput"><input type="checkbox" id="zongBox"><label for="zongBox">全选</label></div><div class="searchInput">查询订单</div><div class="btnEcl">生成表格</div></div>');for(var s=0;s<e.length;s++){var l=e[s].products[0].indexImages.split(",")[0];inputIndex.push(e[s].id);var t="";console.log(),inputEcl.forEach(function(l,a){l==e[s].id&&(t="checked")}),$(".all").append('<div class="details" style="font-size:12px">\n<div class="data"><input type="checkbox" class="inputBox" value="'+e[s].id+'" '+t+"><a> 订单号："+e[s].orderCode+"</a><span>成交时间："+e[s].createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+l+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n'+e[s].products[0].pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+e[s].produtsTypes[0].color+'</span>\n<span class="chima">尺码：'+e[s].produtsTypes[0].size+'</span>\n</div>\n<div class="price price-charge">\n总价：￥'+e[s].totalPrice+'    </div>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+e[s].address.receiver+e[s].address.phone+"<br>\n"+e[s].address.address+'</div>\n<div class="fahuo wuliu-details" title="" >\n查看物流详情\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><ul><li>'+e[s].deliver.dname+"</li><li>"+e[s].deliver.dcode+"</li></ul></div></div></div>\n    </div>")}}function addhtml3_(e){if($(".all").html(""),0===e.length)return $(".all").html("您没有未发货订单！"),!1;$(".all").append('<div class="dBtn"><div class="allInput"><input type="checkbox" id="zongBox"><label for="zongBox">全选</label></div><div class="searchInput">查询订单</div><div class="btnEcl">生成表格</div></div>');for(var s=0;s<e.length;s++){var l=e[s].products[0].indexImages.split(",")[0];inputIndex.push(e[s].id);var t="";console.log(),inputEcl.forEach(function(l,a){l==e[s].id&&(t="checked")}),$(".all").append('<div class="details">\n<div class="data"><input type="checkbox" class="inputBox" value="'+e[s].id+'" '+t+"><a> 订单号："+e[s].orderCode+"</a><span>成交时间："+e[s].createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+l+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n'+e[s].products[0].pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+e[s].produtsTypes[0].color+'</span>\n<span class="chima">尺码：'+e[s].produtsTypes[0].size+'</span>\n</div>\n<div class="price price-charge">\n<div class="status">\n总价：'+e[s].totalPrice+'<span style="margin-left:30px;">数量：'+e[s].amount+'</span></div>\n    </div>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+e[s].address.receiver+e[s].address.phone+"<br>\n"+e[s].address.address+'</div>\n<div style="width:70%;font-size:14px;margin-top:5px">买家备注：<span style="color:blue">'+e[s].leaveMessage+'</span></div><div class="fahuo" title="">\n发货\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><div><input type="text" class="details-ul-input" placeholder="物流公司"></div><ul></ul></div><span class="oid" style="display: none">'+e[s].id+'</span><div class="express"><input type="text" placeholder="物流订单号"></div><div class="express-sure">确定发货</div></div></div>\n<div class="beizhu"><div class="con">卖家备注：<span style="color:red">'+e[s].leaveMessage_seller+'</span></div><div class="id" style="display:none">'+e[s].id+'</div><div class="tianxie">填写备注</div></div></div>')}}function addhtml4_(e){if($(".all").html(""),0===e.length)return $(".all").html("您没有已完成订单！"),!1;$(".all").append('<div class="dBtn"><div class="allInput"><input type="checkbox" id="zongBox"><label for="zongBox">全选</label></div><div class="searchInput">查询订单</div><div class="btnEcl">生成表格</div></div>');for(var s=0;s<e.length;s++){var l=e[s].products[0].indexImages.split(",")[0],t="";inputEcl.forEach(function(l,a){l==e[s].id&&(t="checked")}),$(".all").append('<div class="details" style="font-size:12px">\n<div class="data"><input type="checkbox" class="inputBox" value="'+e[s].id+'" '+t+"><a> 订单号："+e[s].orderCode+"</a><span>成交时间："+e[s].createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+l+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n'+e[s].products[0].pname+'</div>\n<s class="style">\n<span class="yanse">颜色：'+e[s].produtsTypes[0].color+'</span>\n<span class="chima">尺码：'+e[s].produtsTypes[0].size+'</span>\n<span class="price price-charge">\n 总价：'+e[s].totalPrice+" <span>数量："+e[s].amount+'</span>   </s>\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+e[s].address.receiver+e[s].address.phone+"<br>\n"+e[s].address.address+'</div>\n<div class="fahuo wuliu-details" title="">\n删除订单\n</div>\n</div>\n</div>')}}function findlist(e,s,l){for(var t=[],a=0;a<e.length;a++)t.push(e[a].indexOf(l));for(var i=0;i<t.length;i++)t[i]>=0&&(showlist.push(e[i]),enlist.push(s[i]))}var amount_=[],saleNumber_=[],content,conLeng,pages=0,pagesindex=0,showlist=[],enlist=[],dename=[],style,details,html_,nums=0,inputEcl=[],allinput=[],inputIndex=[];"0"===authority&&($(".body-top ul li:gt(0)").css({display:"none"}),$(".body-top ul").css({background:"#18cffb"})),$("body").on("click",".edit",function(){""===$(this).attr("title")?($(this).siblings(".details-details").stop(!0).slideDown(),$(this).prop("title","编辑")):($(this).siblings(".details-details").stop(!0).slideUp(),$(this).prop("title",""))}),$("body").on("click","#zongBox",function(){if($(".all").find(".data").find(".inputBox").prop("checked"))$(".all").find(".data").find(".inputBox").removeAttr("checked");else{var e=$(".all").find(".data").find(".inputBox");$(".all").find(".data").find(".inputBox").attr({checked:"checked"});for(var s=0;s<e.length;s++){var l=e[s].attributes[2].nodeValue;inputEcl.push(l)}}}),$("body").on("click",".searchInput",function(){$(".searchBox").animate({top:"200px"})}),$("body").on("click",".goSearch",function(e){var s=localStorage.getItem("token"),l=$("#shangpin").val(),t=$("#dingdan").val(),a=$("#shangpm").val(),i=$("#dingdanzt option:selected").text(),n=$("#mname").val();console.log(i),$.ajax({type:"POST",url:localhost+"/order/query",data:{sellerId:s,ordercode:t,pcode:l,pname:a,state:i,wxname:n},success:function(e){var s=[],d=e.data;s.push.apply(s,d),console.log(d),""===l&&""===t&&""===a&&""===i&&""===n?alert("至少填写一种搜索信息"):t.length<6&&t.length>0?alert("输入订单号后6位"):0===e.data.length?alert("无数据"):d.forEach(function(e,l){"待付款订单"===e.state?($(".body-top").find("ul").find("li").eq(0).addClass("li-change").siblings().removeClass("li-change"),console.log(1),console.log(e),$(".all").html(""),addhtml1_(s),console.log(s.length)):"待发货订单"===e.state?($(".body-top").find("ul").find("li").eq(1).addClass("li-change").siblings().removeClass("li-change"),console.log(2),console.log(e),$(".all").html(""),addhtml2_(s)):"待收货订单"===e.state?($(".body-top").find("ul").find("li").eq(2).addClass("li-change").siblings().removeClass("li-change"),console.log(3),$(".all").html(""),addhtml3_(s)):"已完成订单"===e.state&&($(".body-top").find("ul").find("li").eq(3).addClass("li-change").siblings().removeClass("li-change"),console.log(4),$(".all").html(""),addhtml4_(s))})}})}),$("body").on("click",".del",function(){$(".searchBox").animate({top:"-700px"}),$("#myform").find("input[type=text],select,input[type=hidden]").each(function(){$(this).val("")})}),$("body").on("click",".btnEcl",function(){0===inputEcl.length?alert("请选择列表!"):$.ajax({url:localhost+"/order/excel",type:"POST",data:{sellerId:token,oids:inputEcl.join("=")},success:function(e){console.log(e),e.error?alert(e.message):null!==e.data?location.href=e.data:alert("数据错误！")}})}),$("body").on("click",".inputBox",function(){var e=$(this).val();$(this).prop("checked")?inputEcl.push(e):inputEcl.splice(e.indexOf(inputEcl),1)}),$.post(localhost+"/order/list",{pageNumber:pages,pageSize:10,sellerId:token,state:"待付款订单",active:!0,online_code:onlinecode},function(e){outline(e);var s=e.data.content;addhtml1_(s),0===s.length?$(".pages").hide():$(".pages").show()}),$(".body-top ul li").click(function(){var e=$(this).index();switch(pagesindex=$(this).index(),pages=0,$(".all").html(""),e){case 0:$.post(localhost+"/order/list",{pageNumber:pages,pageSize:10,sellerId:token,state:"待付款订单",active:!0,online_code:onlinecode},function(e){outline(e);var s=e.data.content;addhtml1_(s),0===s.length?$(".pages").hide():$(".pages").show()});break;case 1:$.post(localhost+"/order/list",{pageNumber:pages,pageSize:10,sellerId:token,state:"待发货订单",online_code:onlinecode},function(e){outline(e);var s=e.data.content;addhtml3_(s),0===s.length?$(".pages").hide():$(".pages").show()});break;case 2:$.post(localhost+"/order/list",{pageNumber:pages,pageSize:10,sellerId:token,state:"待收货订单"},function(e){outline(e);var s=e.data.content;addhtml2_(s),0===s.length?$(".pages").hide():$(".pages").show()});break;case 3:$.post(localhost+"/order/list",{pageNumber:pages,pageSize:10,sellerId:token,state:"已完成订单"},function(e){outline(e);var s=e.data.content;addhtml4_(s),0===s.length?$(".pages").hide():$(".pages").show()})}}),$("body").on("click",".tianxie",function(){$(".con").css({color:"red"});var e=$(this).siblings(".id").text(),s=prompt("请输入备注内容",""),l=$(this);s&&""!==s&&$.post(localhost+"/order/update",{id:e,leaveMessage_seller:s,sellerId:token,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message&&l.siblings(".con").text("卖家备注："+s)})}),$("body").on("click",".revise-price",function(){var e=$(this).siblings(".id").text(),s=prompt("请输入总价",""),l=$(this);s&&""!==s&&$.post(localhost+"/order/update",{id:e,totalPrice:s,changePrice:"yes",sellerId:token,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message&&l.parents(".details").find(".price-all").html(s)})}),$("body").on("click",".cacel-price",function(){var e=$(this).siblings(".id").text(),s=($(this).parents(".details").index(),$(this));confirm("你确定取消订单吗？")&&$.post(localhost+"/order/cancel",{id:e,sellerId:token,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message&&(alert(e.message),s.parents(".details").remove()),0===$(".all").find(".details").length&&$(".all").html("您已经没有待付款订单了！")})}),$("body").on("click",".fahuo",function(){""===$(this).attr("title")?($(this).parents(".details-right-charge").siblings(".details-details-cons").stop(!0).slideDown(),$(this).prop("title","发货")):($(this).parents(".details-right-charge").siblings(".details-details-cons").stop(!0).slideUp(),$(this).prop("title",""))}),$("body").on("input",".details-ul-input",function(){showlist=[],enlist=[];var e=$(this).val();$(this).parents().siblings(".details-ul ul").html(""),/^[\u4E00-\u9FA5]+$/.test(e)&&findlist(list_zh,list_en,e);for(var s=0;s<showlist.length;s++)$(this).parents().siblings(".details-ul ul").append("<li>"+showlist[s]+"</li>");""===e&&$(this).parents().siblings(".details-ul ul").html("")}),$("body").on("click",".details-ul li",function(){(dename=[]).push(enlist[$(this).index()]),$(this).parents(".details-ul ul").siblings("div").find(".details-ul-input").val($(this).text()),$(this).parents(".details-ul ul").html("")}),$("body").on("click",".express-sure",function(){var e=[],s=$(this).parents(".details").index(),l=$(this).siblings(".oid").text(),t=($(this).siblings(".deliverPrice").text(),$(this).siblings(".express").find("input").val()),a=$(this).siblings(".details-ul").find("input").val();e.push(dename[0]),$.post(localhost+"/deliver/save",{oid:l,token:token,dcode:t,dname:a,price:0,dename:e[0],online_code:onlinecode},function(i){outline(i),"操作成功"===i.message?(alert(i.message),$.post(localhost+"/order/changeState",{oid:l,state:"待收货订单",sellerId:token,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message&&$(".all").find(".details").eq(s).remove()})):"信息已存在"===i.message&&confirm("快递"+i.message+"!，确认继续吗？")&&$.post(localhost+"/deliver/save",{oid:l,token:token,dcode:t,dname:a,price:0,dename:e[0],iscontinue:"yes",online_code:onlinecode},function(e){outline(e),"操作成功"===e.message&&$.post(localhost+"/order/changeState",{oid:l,state:"待收货订单",sellerId:token,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message&&$(".all").find(".details").eq(s).remove()})})})}),$(".next").click(function(){if(pages++,0===pagesindex&&pages===nums)return $(".message").html("这已经是最后一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3),pages--,!1;switch(pagesindex){case 0:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,active:!0,state:"待付款订单",online_code:onlinecode},html_=addhtml1_;break;case 1:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"待发货订单",online_code:onlinecode},html_=addhtml3_;break;case 2:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"待收货订单",online_code:onlinecode},html_=addhtml2_;break;case 3:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"已完成订单",online_code:onlinecode},html_=addhtml4_}$.post(localhost+style,details,function(e){if(outline(e),content=e.data.content,console.log(content),0===content.length){switch($(".message").html("这已经是最后一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3),pages--,pagesindex){case 0:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,active:!0,state:"待付款订单",online_code:onlinecode},html_=addhtml1_;break;case 1:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"待发货订单",online_code:onlinecode},html_=addhtml3_;break;case 2:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"待收货订单",online_code:onlinecode},html_=addhtml2_;break;case 3:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"已完成订单",online_code:onlinecode},html_=addhtml4_}$.post(localhost+style,details,function(e){outline(e),content=e.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()})}else content=e.data.content,html_(content)})}),$(".last").click(function(){if(--pages<0)pages=0,$(".message").html("这已经是第一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3);else{switch(pagesindex){case 0:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,active:!0,state:"待付款订单",online_code:onlinecode},html_=addhtml1_;break;case 1:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"待发货订单",online_code:onlinecode},html_=addhtml3_;break;case 2:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"待收货订单",online_code:onlinecode},html_=addhtml2_;break;case 3:style="/order/list",details={pageNumber:pages,pageSize:10,sellerId:token,state:"已完成订单",online_code:onlinecode},html_=addhtml4_}$.post(localhost+style,details,function(e){outline(e),content=e.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()})}});
/*2017-12-28*/