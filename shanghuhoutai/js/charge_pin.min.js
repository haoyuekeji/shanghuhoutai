/*By 任龙飞—renlongfei*/
var amount_=[],saleNumber_=[],content,pages=0,pagesindex=0,showlist=[],enlist=[],dename=[],style_="/tuan/product/list",details_={pageNumber:pages,pageSize:10,saleId:token,active:!0,online_code:onlinecode},html_=addhtml_,nums=0;"0"===authority&&($(".body-top ul li:gt(0)").css({display:"none"}),$(".body-top ul").css({background:"#18cffb"})),$("body").on("click",".edit",function(){""===$(this).attr("title")?($(this).parents(".details").find(".details-details").stop(!0).slideDown(),$(this).prop("title","编辑")):($(this).parents(".details").find(".details-details").stop(!0).slideUp(),$(this).prop("title",""))});function chageStyle(s,t,e){console.log(s),2===arguments.length?(this.style_=s,this.details_={pageNumber:pages,pageSize:10,saleId:token,active:!0,online_code:onlinecode},this.html_=t):(this.style_=s,this.details_={pageNumber:pages,pageSize:10,saleId:token,active:!0,state:e,online_code:onlinecode},this.html_=t)}function addhtml_(s){if($(".all").html(""),$(".pages").show(),0===s.length)return $(".all").html('您没有发布任何商品！<a href="push_pin.html" style="color:red">点击发布</a>'),!1;for(var t=0;t<s.length;t++){console.log(s);var e=0,a=s[t].indexPic.split(",")[0];s[t].productsTypes.forEach(function(s,t){e+=s.amount}),amount_.push(e),$(".all").append('<div class="details"><div class="id_id" style="display:none;">'+s[t].id+'</div><div class="details-con"><div class="details-con-img"><img src="'+a+'" alt="">\n</div><div class="details-con-seller"><p class="pname">'+s[t].pname+'</p><div class="produt-id" style="color:red;">商品编号：<span>'+s[t].id+'</span></div><div class="surplus"><span class="nums" style="color:#888888; font-size:10px">\n剩余库存：'+amount_[t]+"&nbsp&nbsp&nbsp\n已卖出："+s[t].saleNum+'</span>\n</div></div></div><div class="details-slidedown"><div class="edit" title="">编辑</div>\n<div class="down" title="">下架</div>\n<div class="fix" title="">修改</div>\n</div><div class="details-details">\n<div class="">\n<span>颜色</span>\n<span>尺码</span>\n<span>单价</span>\n<span>修改单价</span>\n<span>库存</span>\n<span>增加库存</span>\n<span>下架</span>\n<span class="active" style="display:none">'+s[t].active+"</span></div>\n</div>\n</div>");for(var n=0;n<s[t].productsTypes.length;n++)$(".details-details").eq(t).append('<div class="list">\n<span>'+s[t].productsTypes[n].color+"</span>\n<span>"+s[t].productsTypes[n].size+'</span>\n<span class="newPrice">'+s[t].productsTypes[n].newPrice+'</span>\n<span><span class="id" style="display: none">'+s[t].productsTypes[n].id+'</span><input type="text"><span class="sure-price">确定</span></span>\n<span class="amount">'+s[t].productsTypes[n].amount+'</span>\n<span><span class="id" style="display: none">'+s[t].productsTypes[n].id+'</span><input type="text"><span class="sure-nums">确定</span></span>\n<span class="del"><span class="pid" style="display: none">'+s[t].id+'</span><span class="id" style="display: none">'+s[t].productsTypes[n].id+'</span><span class="pactive" style="display: none">'+s[t].productsTypes[n].isActive+"</span>下架</span> </div>\n")}}function addhtml1_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有待拼订单！"),!1;for(var t=[],e=0;e<s.length;e++){var a=s[e].products.indexPic.split(",")[0],n=0;s[e].products.productsTypes.forEach(function(s,t){n+=s.amount}),t.push(n),$(".all").append('<div class="details">\n    <div class="details-left">\n           <img src="'+a+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>团购订单号：'+s[e].iterable[0].groupCode+"  </br>  个人订单号："+s[e].iterable[0].code+"</div>\n"+s[e].products.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[e].products.productsTypes[0].color+'</span>\n<span class="chima">尺码：'+s[e].products.productsTypes[0].size+'</span>\n</div>\n<div class="price price-charge">\n标价：￥<span style="color:black;text-decoration: none">'+s[e].products.productsTypes[0].tuanPrice+'</div>\n    <span class="nums num">\n剩余库存：'+t[0]+"    已卖出： "+s[e].products.saleNum+'\n</span>\n</div>\n<div class="details-right-charge">\n<div class="fahuo revise-price" title="">\n更多\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul-wait-pin"></div></div></div>\n    </div>');for(var i=s[e].iterable,d=0;d<i.length;d++){var l=i[d].endDate;l=(l=new Date(Date.parse(l.replace(/-/g,"/")))).getTime();$(".details-ul-wait-pin").eq(e).append('<ul><li class="wait-pin"><div>拼主：<span>'+i[d].owner+'</span></div><div>还差<span style="color:red">'+(i[d].startNum-i[d].joinNum)+'</span>人</div><div>剩余时间：<span style="color:red">'+function(s){var t=s-Date.now(),e=Math.floor(t/36e5),a=t-3600*e*1e3,n=Math.floor(a/6e4),i=(a-60*n*1e3)/1e3;return e.toString()+": "+n.toString()+": "+i.toFixed(2)}(l)+"</span></div></li></ul>")}}}function addhtml2_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有已发货个人订单！"),!1;for(var t=0;t<s.length;t++){var e=s[t].tProducts.indexPic.split(",")[0],a=0;s[t].tProducts.productsTypes.forEach(function(s,t){a+=s.amount}),amount_.push(a),$(".all").append('<div class="details">\n    <div class="details-left">\n           <img src="'+e+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>订单号：'+s[t].code+"</div>\n"+s[t].tProducts.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[t].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+s[t].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge">\n售价：￥'+s[t].totalPrice+'    </div>\n    <span class="nums num">\n剩余库存：'+amount_[0]+"已卖出： "+s[t].saleNum+'\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+s[t].tDeliver.receiver+s[t].tDeliver.phone+"<br>\n"+s[t].tDeliver.address+'</div>\n<div class="status">\n待签收 '+s[t].amount+"件 总价："+s[t].totalPrice+'</div>\n<div class="data">\n'+s[t].createDate+'</div>\n<div class="fahuo wuliu-details" title="">\n查看物流详情\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><ul><li>'+s[t].tDeliver.dname+"</li><li>"+s[t].tDeliver.dcode+"</li></ul></div></div></div>\n    </div>")}}function addhtml3_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有未发货个人订单！"),!1;for(var t=[],e=0;e<s.length;e++){var a=s[e].tProducts.indexPic.split(",")[0],n=0;s[e].tProducts.productsTypes.forEach(function(s,t){n+=s.amount}),t.push(n),$(".all").append('<div class="details">\n    <div class="details-left">\n           <img src="'+a+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>订单号：'+s[e].code+"</div>\n"+s[e].tProducts.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[e].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+s[e].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge">\n<div class="status">\n总价：'+s[e].totalPrice+'</div>\n    </div>\n    <span class="nums num">\n剩余库存：'+t[0]+'<span style="margin-left: 30px">已卖出：'+s[e].tProducts.saleNum+'</span>\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n<span class="deliverId" style="display:none">'+s[e].tDeliver.id+"</span>"+s[e].tDeliver.receiver+s[e].tDeliver.phone+"<br>\n"+s[e].tDeliver.address+'</div>\n<div class="data">\n'+s[e].createDate+"<br><span>待发货数量："+s[e].amount+'</span></div>\n<div class="fahuo" title="">\n发货\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><div><input type="text" class="details-ul-input" placeholder="物流公司"></div><ul></ul></div><span class="oid" style="display: none">'+s[e].id+'</span><div class="express"><input type="text" placeholder="物流订单号"></div><div class="express-sure">确定发货</div></div></div>\n</div>')}}function addhtml4_(s){if($(".all").html(""),$(".pages").show(),0===s.length)return $(".all").html("您没有已下架商品！"),!1;for(var t=0;t<s.length;t++){var e=0,a=(e=[],s[t].indexPic.split(",")[0]);s[t].productsTypes.forEach(function(s,t){e+=s.amount}),amount_.push(e),$(".all").append('<div class="details"><div class="id_id" style="display:none;">'+s[t].id+'</div><div class="details-con"><div class="details-con-img"><img src="'+a+'" alt="">\n</div><div class="details-con-seller"><p class="pname">'+s[t].pname+'</p><div class="produt-id" style="color:red;">商品编号：<span>'+s[t].id+'</span></div><div class="surplus"><span class="nums" style="color:#888888; font-size:10px">\n剩余库存：'+amount_[t]+"&nbsp&nbsp&nbsp\n已卖出："+s[t].saleNum+'</span>\n</div></div></div><div class="details-slidedown"><div class="edit" title="">编辑</div>\n<div class="shangjia" title="">上架</div>\n<div class="fix" title="">修改</div>\n</div>                <div class="details-details">\n                    <div class="">\n                        <span>颜色</span>\n                        <span>尺码</span>\n                        <span>单价</span>\n                        <span>修改单价</span>\n                        <span>库存</span>\n                        <span>增加库存</span>\n                        <span>下架</span>\n<span class="active" style="display:none">'+s[t].active+"</span>                    </div>\n                </div>\n</div>");for(var n=0;n<s[t].productsTypes.length;n++)$(".details-details").eq(t).append('<div class="list">\n<span>'+s[t].productsTypes[n].color+"</span>\n<span>"+s[t].productsTypes[n].size+'</span>\n<span class="newPrice">'+s[t].productsTypes[n].newPrice+'</span>\n<span><span class="id" style="display: none">'+s[t].productsTypes[n].id+'</span><input type="text"><span class="sure-price">确定</span></span>\n<span class="amount">'+s[t].productsTypes[n].amount+'</span>\n<span><span class="id" style="display: none">'+s[t].productsTypes[n].id+'</span><input type="text"><span class="sure-nums">确定</span></span>\n<span class="del"><span class="pid" style="display: none">'+s[t].id+'</span><span class="id" style="display: none">'+s[t].productsTypes[n].id+'</span><span class="pactive" style="display: none">'+s[t].productsTypes[n].isActive+"</span>下架</span> </div>\n")}}function addhtml5_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有已完成的个人订单！"),!1;for(var t=0;t<s.length;t++){var e=s[t].tProducts.indexPic.split(",")[0],a=0;s[t].tProducts.productsTypes.forEach(function(s,t){a+=s.amount}),amount_.push(a),$(".all").append('<div class="details">\n    <div class="details-left">\n           <img src="'+e+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>订单号：'+s[t].code+"</div>\n"+s[t].tProducts.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[t].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+s[t].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge" style="color:red">\n售价：￥'+s[t].totalPrice+'  &nbsp&nbsp<span style="text-decoration: line-through;color:#999;">'+s[t].tProductsTypes.newPrice+'</span>    </div>\n    <span class="nums num">\n剩余库存：'+amount_[0]+"已卖出： "+s[t].tProducts.saleNum+'\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+s[t].tDeliver.receiver+s[t].tDeliver.phone+"<br>\n"+s[t].tDeliver.address+'</div>\n<div class="data">\n'+s[t].createDate+'<div class="status">\n已完成 '+s[t].amount+"件 总价："+s[t].totalPrice+"</div>\n</div>\n</div>\n    </div>")}}function addhtml6_(s){$(".all").html(""),0===s.length||null===s?$(".all").append("您没有未发货的团购订单"):s.forEach(function(s,t){var e=[],a={},n=0,i=[];s.tuanOrdersList.forEach(function(s,t){a[s.groupCode]||(e.push(s.groupCode),a[s.groupCode]=1)}),s.products.productsTypes.forEach(function(s,t){n+=s.amount}),i.push(n);var d=s.products.indexPic.split(",")[0];$(".all").append('<div class="details"><div class="details-left"><img src="'+d+'" alt=""> </div> <div class="details-con width"><div class="details-con-top">'+s.products.pname+'</div><div class="price price-charge price-tuan"> ￥'+s.products.productsTypes[0].tuanPrice+" <span>￥"+s.products.productsTypes[0].newPrice+'</span></div><span class="nums num">剩余库存：'+i[0]+" 已卖出："+s.products.saleNum+' </span></div><div class="fahuo-tuan" title=""> <input type="button" value="填写物流单号" name="true"> </div><div class="details-details-cons-tuan"> </div></div>');for(var l=0;l<e.length;l++){$(".details-details-cons-tuan").eq(t).append(' <div class="ordernumber-tuan"> <div>团购号：'+e[l]+'</div><div class="order-img" title="true"> <img src="images/arrow-down.png" alt="" width="100%"></div></div><div class="details-details-cons-tuan-cons"></div>');for(var o=s.tuanOrdersList,c=0;c<o.length;c++)o[c].groupCode===e[l]&&$(".details-details-cons-tuan").eq(t).find(".details-details-cons-tuan-cons").eq(l).append('  <div class="details-details-cons-tuan-con"><div class="order-datails"> <div class="order-details-con"> <span>订单号：'+o[c].code+"</span><span>"+o[c].tDeliver.receiver+o[c].tDeliver.phone+"</span> <span>"+o[c].tDeliver.address+'</span><span class="dliverid" style="display:none">'+o[c].tDeliver.id+'</span><span class="tuanid" style="display:none">'+o[c].id+'</span> </div><div class="order-details-con"> <span>颜色：'+o[c].tProductsTypes.color+" 尺码："+o[c].tProductsTypes.size+"</span> <span>待发货 "+o[c].amount+"件 总价"+o[c].totalPrice+'</span> </div> </div> <span class="order-creattime">'+o[c].tDeliver.createDate+'</span> <div class="express-tuan"> <div class="express-tuan-con">  <span>联系物流</span>   <input type="text" placeholder="运单号">  <input type="text" placeholder="物流公司"> <div class="fahuo-geren">    发货 </div> </div> </div> </div>')}})}function addhtml7_(s){$(".all").html(""),0===s.length||null===s?$(".all").append("您没有已发货的团购订单"):s.forEach(function(s,t){var e=[],a={},n=0,i=[];s.tuanOrdersList.forEach(function(s,t){a[s.groupCode]||(e.push(s.groupCode),a[s.groupCode]=1)}),s.products.productsTypes.forEach(function(s,t){n+=s.amount}),i.push(n);var d=s.products.indexPic.split(",")[0];$(".all").append('<div class="details"><div class="details-left"> <img src="'+d+'" alt=""></div><div class="details-con width"> <div class="details-con-top">'+s.products.pname+' </div> <div class="price price-charge price-tuan">'+s.products.productsTypes[0].tuanPrice+"<span>￥"+s.products.productsTypes[0].newPrice+'</span></div><span class="nums num">  剩余库存：'+i[0]+" 已卖出："+s.products.saleNum+' </span> </div> <div class="fahuo-tuan-ready" title="true">   <input type="button" value="更多" name="true"> </div> <div class="details-details-cons-tuan-ready"> </div></div>');for(var l=0;l<e.length;l++){$(".details-details-cons-tuan-ready").eq(t).append(' <div class="ordernumber-tuan">  <div>团购号：'+e[l]+'</div><div class="order-img" title="true" style="margin-right:15px;"> <img src="images/arrow-down.png" alt="" width="100%"></div></div> <div class="details-details-cons-tuan-cons"> </div>');for(var o=s.tuanOrdersList,c=0;c<o.length;c++)$(".details-details-cons-tuan-ready").eq(t).find(".details-details-cons-tuan-cons").eq(l).append('<div class="details-details-cons-tuan-con">   <div class="order-datails">  <div class="order-details-con">   <span>订单号：'+o[c].code+"</span>  <span>"+o[c].tDeliver.receiver+"   "+o[c].tDeliver.phone+"</span>    <span>"+o[c].tDeliver.address+'</span> </div> <div class="order-details-con"> <span>颜色：'+o[c].tProductsTypes.color+" 尺码："+o[c].tProductsTypes.size+"</span>   <span>已发货 "+o[c].amount+"件 总价"+o[c].totalPrice+'</span> </div> </div> <span class="order-creattime">'+o[c].tDeliver.createDate+'</span> </div><div class="show-express">  <input type="button" value="查看物流" name="true"></div><div class="details-details-cons-tuan-express-con"> <div class="order-number-ready">   运单号：<span class="dcode">'+o[c].tDeliver.dcode+' </span></div> <div class="order-number-ready">   快递公司：<span class="dcode">'+o[c].tDeliver.dname+" </span></div><ul> </ul> </div> </div>")}})}function addhtml8_(s){$(".all").html(""),0===s.length||null===s?$(".all").append("您没有已完成的团购订单"):s.forEach(function(s,t){var e=[],a={},n=0,i=[];s.tuanOrdersList.forEach(function(s,t){a[s.groupCode]||(e.push(s.groupCode),a[s.groupCode]=1)}),s.products.productsTypes.forEach(function(s,t){n+=s.amount}),i.push(n);var d=s.products.indexPic.split(",")[0];$(".all").append('<div class="details"><div class="details-left"> <img src="'+d+'" alt=""></div><div class="details-con width"> <div class="details-con-top">'+s.products.pname+' </div> <div class="price price-charge price-tuan">'+s.products.productsTypes[0].tuanPrice+"<span>￥"+s.products.productsTypes[0].newPrice+'</span></div><span class="nums num">  剩余库存：'+i[0]+" 已卖出："+s.products.saleNum+' </span> </div> <div class="fahuo-tuan-ready" title="true">   <input type="button" value="更多" name="true"> </div> <div class="details-details-cons-tuan-ready"> </div></div>');for(var l=0;l<e.length;l++){$(".details-details-cons-tuan-ready").eq(t).append(' <div class="ordernumber-tuan">  <div>团购号：'+e[l]+'</div><div class="order-img" title="true" style="margin-right:15px;"> <img src="images/arrow-down.png" alt="" width="100%"></div></div> <div class="details-details-cons-tuan-cons"> </div>');for(var o=s.tuanOrdersList,c=0;c<o.length;c++)$(".details-details-cons-tuan-ready").eq(t).find(".details-details-cons-tuan-cons").eq(l).append('<div class="details-details-cons-tuan-con">   <div class="order-datails">  <div class="order-details-con">   <span>订单号：'+o[c].code+"</span>  <span>"+o[c].tDeliver.receiver+"   "+o[c].tDeliver.phone+"</span>    <span>"+o[c].tDeliver.address+'</span> </div> <div class="order-details-con"> <span>颜色：'+o[c].tProductsTypes.color+" 尺码："+o[c].tProductsTypes.size+"</span>   <span>已完成 "+o[c].amount+"件 总价"+o[c].totalPrice+'</span> </div> </div> <span class="order-creattime">'+o[c].tDeliver.createDate+'</span> </div><div class="show-express">  <input type="button" value="查看物流" name="true"></div><div class="details-details-cons-tuan-express-con"> <div class="order-number-ready">   运单号：<span class="dcode">'+o[c].tDeliver.dcode+' </span></div> <div class="order-number-ready">   快递公司：<span class="dcode">'+o[c].tDeliver.dname+" </span></div><ul> </ul> </div> </div>")}})}$(".body-top ul li").click(function(){var s=$(this).index();switch(pages=0,$(".all").html(""),s){case 0:$.post(localhost+"/tuan/product/list",{pageNumber:pages,pageSize:10,saleId:token,active:!0,online_code:onlinecode},function(s){outline(s);for(var t=s.data.content,e=t.length-1;e>=0;e--)0===t[e].productsTypes.length&&t.splice(e,1);addhtml_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/product/list",addhtml_);break;case 1:$.post(localhost+"/tuan/product/list",{saleId:token,active:!1,online_code:onlinecode},function(s){outline(s);var t=s.data.content;addhtml4_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/product/list",addhtml4_),details_.active=!1}}),$("body").on("click",".tuan",function(s){var t=$(this).parents("li").index();switch(pages=0,t){case 2:return $.post(localhost+"/tuan/tuanorders/list",{saleId:token,state:"待收货团购订单",online_code:onlinecode},function(s){outline(s);var t=s.data;addhtml7_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/tuanorders/list",addhtml7_,"待收货团购订单"),!1;case 3:$.post(localhost+"/tuan/tuanorders/list",{saleId:token,state:"待发货团购订单",online_code:onlinecode},function(s){outline(s);var t=s.data;addhtml6_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/tuanorders/list",addhtml6_,"待发货团购订单");break;case 5:$.post(localhost+"/tuan/tuanorders/list",{saleId:token,state:"已完成团购订单",showsale:!0,online_code:onlinecode},function(s){outline(s);var t=s.data;addhtml8_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/tuanorders/list",addhtml8_,"已完成团购订单")}return!1}),$("body").on("click",".person",function(){var s=$(this).parents("li").index();switch(pages=0,s){case 2:$.post(localhost+"/tuan/torders/list",{saleId:token,state:"待收货订单",online_code:onlinecode},function(s){outline(s);var t=s.data.content;addhtml2_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/torders/list",addhtml2_,"待收货订单");break;case 3:$.post(localhost+"/tuan/torders/list",{saleId:token,state:"待发货订单",online_code:onlinecode},function(s){outline(s);var t=s.data.content;addhtml3_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/torders/list",addhtml3_,"待发货订单");break;case 5:$.post(localhost+"/tuan/torders/list",{saleId:token,state:"已完成订单",showsale:!0,online_code:onlinecode},function(s){outline(s);var t=s.data.content;addhtml5_(t),0===t.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/torders/list",addhtml5_,"已完成订单")}}),$.post(localhost+"/tuan/product/list",{saleId:token,active:!0,online_code:onlinecode},function(s){outline(s);for(var t=s.data.content,e=t.length-1;e>=0;e--)0===t[e].productsTypes.length&&t.splice(e,1);nums=s.token-0,0===t.length&&$(".pages").hide(),addhtml_(t)}),$("body").on("click",".sure-price",function(){var s=$(this).siblings("input").val();if(""!==s&&/^\d{0,8}\.{0,1}(\d{1,2})?$/.test(s)){var t=$(this).siblings(".id").html(),e=$(this).parents(".details").find(".active").html(),a=$(this).parents(".details").find(".amount").html(),n=$(this);$.post(localhost+"/tuan/produttypes/update",{saleId:token,id:t,active:e,newPrice:s,amount:a,online_code:onlinecode},function(t){outline(t),"操作成功"===t.message?(n.parents(".list").find(".newPrice").text(s),n.siblings("input").val("")):alert("未修改成功！")})}}),$("body").on("click",".sure-nums",function(){var s=$(this).siblings("input").val();if(""!==s){var t=$(this).siblings(".id").html(),e=$(this).parents(".details").find(".active").html(),a=$(this).parents(".details").find(".newPrice").html(),n=$(this);$.post(localhost+"/tuan/produttypes/update",{saleId:token,id:t,active:e,amount:s,newPrice:a,online_code:onlinecode},function(t){outline(t),"操作成功"===t.message?(n.parents("span").siblings("span").eq(4).html(s),n.siblings("input").val("")):alert("未修改成功！")})}}),$("body").on("click",".del",function(){var s=$(this).parents(".details").find(".produt-id span").text(),t=$(this).parents(".details").index(),e=$(this).parents(".list").index()-1,a=$(this).find(".id").html(),n=$(this).parents(".list").find(".amount").html(),i=$(this).parents(".list").find(".newPrice").html();$(this);$.post(localhost+"/tuan/produttypes/update",{saleId:token,id:a,active:!1,amount:n,newPrice:i,online_code:onlinecode},function(a){outline(a),"操作成功"===a.message&&$(".details").eq(t).find(".list").eq(e).remove(),0===$(".details").eq(t).find(".del").length&&$.post(localhost+"/tuan/product/update",{saleId:token,id:s,active:!1,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(t).remove()}),0===$(".details").length&&$(".pages").hide()})}),$("body").on("click",".down",function(){var s=$(this).parents(".details").find(".produt-id span").text(),t=$(this).parents(".details").index();$.post(localhost+"/tuan/product/update",{saleId:token,id:s,active:!1,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(t).remove()})}),$("body").on("click",".fix",function(){var s=$(this).parents(".details").find(".produt-id span").text(),t=$(this).parents(".details").find(".active").text();console.log(s),localStorage.setItem("fix",s),localStorage.setItem("isactive",t),location.href="fix_pin.html"}),$("body").on("click",".shangjia",function(){var s=$(this).parents(".details").find(".id_id").text(),t=$(this);$.post(localhost+"/tuan/product/update",{saleId:token,id:s,active:!0,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&(alert("上架成功！"),t.parents(".details").remove())})});function findlist(s,t,e){for(var a=[],n=0;n<s.length;n++)a.push(s[n].indexOf(e));for(var i=0;i<a.length;i++)a[i]>=0&&(showlist.push(s[i]),enlist.push(t[i]))}$("body").on("click",".fahuo",function(){""===$(this).attr("title")?($(this).parents(".details-right-charge").siblings(".details-details-cons").stop(!0).slideDown(),$(this).prop("title","发货")):($(this).parents(".details-right-charge").siblings(".details-details-cons").stop(!0).slideUp(),$(this).prop("title",""))}),$(".all").on("click",".fahuo-tuan input",function(){var stu=!0===eval($(this).prop("name"));$(this).prop("name",!stu),stu?($(this).val("隐藏"),$(this).parents(".details").find(".details-details-cons-tuan").slideDown()):($(this).val("填写物流单号"),$(this).parents(".details").find(".details-details-cons-tuan").slideUp())}),$(".all").on("click",".order-img",function(){var stu=!0===eval($(this).prop("title"));$(this).prop("title",!stu),stu?($(this).css({transform:"rotate(180deg)"}),$(this).parent(".ordernumber-tuan").next(".details-details-cons-tuan-cons").slideDown()):($(this).css({transform:" rotate(0deg)"}),$(this).parent(".ordernumber-tuan").next(".details-details-cons-tuan-cons").slideUp())}),$(".all").on("click",".fahuo-tuan-ready input",function(){var stu=!0===eval($(this).prop("name"));$(this).prop("name",!stu),stu?($(this).val("隐藏"),$(this).parents(".details").find(".details-details-cons-tuan-ready").slideDown()):($(this).val("更多"),$(this).parents(".details").find(".details-details-cons-tuan-ready").slideUp())}),$(".all").on("click",".show-express input",function(){var stu=!0===eval($(this).prop("name"));$(this).prop("name",!stu);var dcode=$(this).parent(".show-express").siblings(".details-details-cons-tuan-express-con").find(".dcode").text();stu?$(this).parents(".show-express").next(".details-details-cons-tuan-express-con").slideDown():$(this).parents(".show-express").next(".details-details-cons-tuan-express-con").slideUp()}),$("body").on("input",".details-ul-input",function(){showlist=[],enlist=[];var s=$(this).val();$(this).parents().siblings(".details-ul ul").html("");/^[\u4E00-\u9FA5]+$/.test(s)&&findlist(list_zh,list_en,s);for(var t=0;t<showlist.length;t++)$(this).parents().siblings(".details-ul ul").append("<li>"+showlist[t]+"</li>");""===s&&$(this).parents().siblings(".details-ul ul").html("")}),$("body").on("click",".details-ul li",function(){(dename=[]).push(enlist[$(this).index()]),$(this).parents(".details-ul ul").siblings("div").find(".details-ul-input").val($(this).text()),$(this).parents(".details-ul ul").html("")}),$("body").on("click",".express-sure",function(){var s=$(this).parents(".details").index(),t=$(this).siblings(".oid").text(),e=$(this).siblings(".express").find("input").val(),a=$(this).siblings(".details-ul").find("input").val(),n=$(this).parents(".details").find(".deliverId").html();$.post(localhost+"/tuan/tdeliver/update",{id:n,oid:t,saleId:token,dcode:e,dname:a,online_code:onlinecode},function(e){outline(e),1==e.error?alert(e.message):"操作成功"===e.message&&(alert(e.message),$.post(localhost+"/tuan/torders/changestate",{oid:t,state:"待收货订单",saleId:token,online_code:onlinecode},function(t){outline(t),1==t.error?alert(t.message):"操作成功"===t.message&&$(".all").find(".details").eq(s).remove()}))})}),$(".all").on("click",".fahuo-geren",function(){var s=$(this).parents(".details-details-cons-tuan-con").find(".dliverid").html(),t=$(this).parents(".details-details-cons-tuan-con").find(".tuanid").html(),e=$(this).parents(".express-tuan-con").find("input").eq(0).val(),a=$(this).parents(".express-tuan-con").find("input").eq(1).val(),n=$(this).parents(".details-details-cons-tuan-con").index(),i=$(this);$.post(localhost+"/tuan/tdeliver/update_tuan",{id:s,dcode:e,dname:a,saleId:token,oid:t,online_code:onlinecode},function(s){outline(s),s.error?alert(s.message):"操作成功"===s.message&&$.post(localhost+"/tuan/tuanorders/changestate",{oid:t,state:"待收货团购订单",saleId:token,online_code:onlinecode},function(s){outline(s),s.error?alert(s.message):"操作成功"===s.message?(alert("发货成功"),i.parents(".details-details-cons-tuan-cons").find(".details-details-cons-tuan-con").eq(n).remove(),0===i.parents(".details-details-cons-tuan-cons").find(".details-details-cons-tuan-con").length&&i.parents(".details-details-cons-tuan-cons").remove()):alert(s.message)})})}),$(".next").click(function(){pages++,details_.pageNumber=pages,$.post(localhost+style_,details_,function(s){outline(s),0===(content=void 0===s.data.content?s.data:s.data.content).length?($(".message").html("这已经是最后一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3),pages--,details_.pageNumber=pages,$.post(localhost+style_,details_,function(s){outline(s),content=void 0===s.data.content?s.data:s.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()})):(content=void 0===s.data.content?s.data:s.data.content,html_(content))})}),$(".last").click(function(){--pages<0?(pages=0,$(".message").html("这已经是第一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3)):(details_.pageNumber=pages,$.post(localhost+style_,details_,function(s){outline(s),content=void 0===s.data.content?s.data:s.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()}))});
/*2018-01-08*/