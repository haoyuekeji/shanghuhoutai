/*By 任龙飞—renlongfei*/
var height=$(window).height(),push_stu=0;$(".body-left").css({height:height});var pic,pic_zhu,maxFileCount1=0,maxFileCount2=0,invoice_type="无",All=[];"3"!==token&&(maxFileCount1=5,maxFileCount2=10);function arrow_show(n,i,t){switch(i){case"mouseover":var e=0;break;case"mouseleave":e="-20px"}$(n).on(i,t,function(){$(this).find(".last").stop(!0).animate({left:e},300),$(this).find(".next").stop(!0).animate({right:e},300)})}function ArrChange(n,i,t){switch(n){case 0:t>0&&(i.splice(t-1,0,i[t]),i.splice(t+1,1));break;case 1:t<i.length-1&&(i.splice(t+2,0,i[t]),i.splice(t,1))}}$.post(localhost+"/ptypename/list",{sellerId:token,online_code:onlinecode},function(n){if(outline(n),null!==n.data){for(var i=n.data.ptypename.split(","),t=0;t<i.length;t++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+i[t]+"</span></div>");arrow_show(".span","mouseover",".span-span"),arrow_show(".span","mouseleave",".span-span"),$(".span").on("click",".last",function(){var n=$(this).parents(".span-span").index();ArrChange(0,i,n),$(".span").html("");for(var t=0;t<i.length;t++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+i[t]+"</span></div>");return!1}),$(".span").on("click",".next",function(){var n=$(this).parents(".span-span").index();ArrChange(1,i,n),$(".span").html("");for(var t=0;t<i.length;t++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+i[t]+"</span></div>");return!1}),$(".button").click(function(){$.post(localhost+"/ptypename/save",{id:n.data.id,sellerId:token,ptypename:i.join(",")},function(n){})})}}),$.post(localhost+"/deliver/getTemplate",{sellerId:token,online_code:onlinecode},function(n){outline(n);for(var i=n.data,t=0;t<i.length;t++)$("select").append("<option>"+i[t][0].dname+"</option>")}),$("body").on("blur",".chima",function(){$(this).addClass("transform")}),$(".span").on("click",".span-span",function(){$(".span").siblings(".classify").find("input").val($(this).find("span").text())}),$("body").on("click",".clickdb",function(){$(this).prop("readonly",!1)}),$("body").on("blur",".clickdb",function(){$(this).prop("readonly",!0)}),$("body").on("click",".del",function(){$(".del").length>1&&$(this).parents(".all").remove()}),$("body").on("click",".del_",function(){$(this).parents(".all-con-right").find(".push-details").length>1&&$(this).parents(".push-details").parents("li").remove()}),$("body").on("click",".all-top .jia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("click",".all-top .djia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .jia",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".jiage").val(n)}),$("body").on("blur",".all-top .djia",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".disjiage").val(n)}),$("body").on("click",".all-top .cunliang",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .cunliang",function(){var n=$(this).find("input").val(),i=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(i).find(".nums").val(n)}),$("body").on("click",".add_",function(){$(this).siblings("ul").append('<li>\n                                <ul class="push-details">\n                                    <li><span>\n                                      <input type="text" placeholder=\'列如："S"\' class="chima">\n                                </span></li>\n                <li><input type="text" readonly class="clickdb disjiage"></li><li><input type="text" readonly class="clickdb jiage"></li> <li><input type="text" readonly class="clickdb mjiage"></li> <li><input type="text" readonly class="clickdb nums"></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>')}),$("body").on("click","#checkBox",function(){$(this).is(":checked")?$(".allPdan").css({display:"block"}):$(".allPdan").css({display:"none"})}),$(".add").click(function(){$(".sure").append('<div class="all">\n                <div class="all-top">\n                    <ul>\n                        <li style="width: 90px">颜色</li>\n                        <li>尺码</li>\n<li style="position: relative" class="djia"><span style="cursor: pointer">折扣价<span style="font-size: 12px;display: block">(双击一键添加)</span></span><input type="text" style="height: 100%;width: 64%;position: absolute;left:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center"></li>                        <li style="position: relative" class="jia">\n                            <span style="cursor: pointer;display: block">原价\n                                <span style="font-size: 12px">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n<li style="position: relative" class="djia"><span style="cursor: pointer">秒杀价<span style="font-size: 12px;display: block">(双击一键添加)</span></span><input type="text" style="height: 100%;width: 64%;position: absolute;left:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center"></li>                        <li style="position: relative" class="cunliang">\n                            <span>库存\n                                <span style="font-size: 12px;display: block">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                    </ul>\n                </div>\n                <div class="all-con">\n                    <div class="all-con-left">\n                        <input type="text"  readonly class="clickdb">\n                    </div>\n                    <div class="all-con-right">\n                        <ul>\n<li>\n                                <ul class="push-details">\n                                    <li><span>\n                                      <input type="text" placeholder=\'列如："S"\' class="chima">\n                                </span></li>\n                <li><input type="text" readonly class="clickdb disjiage"></li><li><input type="text" readonly class="clickdb jiage"></li><li><input type="text" readonly class="clickdb mjiage"></li> <li><input type="text" readonly class="clickdb nums"></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>                        </ul>\n<div class="add_"><img src="images/add.png" alt=""></div>                    </div>\n                    <div class="del">\n                        <img src="images/del.png" alt="">\n                    </div>\n                </div>\n            </div>')}),$(".sure").on("input","input",function(){All=[],$(".button").html("保存")}),$(".button").click(function(){var n=!0;if($(".sure").find(".all-con-left input").each(function(i,t){""===t.value&&(alert("有颜色栏未填写，如不需要请点击右上角删除！"),n=!1)}),!0!==n)return!1;if($(".sure").find(".all-con-right span input").each(function(i,t){""===t.value&&(alert("有尺寸栏未填写，如不需要请点击右上角删除！"),n=!1)}),!0!==n)return!1;All=[];for(var i=0,t=0;t<$(".disjiage").length;t++)$(".disjiage").eq(t).val()<=0&&i++;if(i>0)return alert("折扣价不得为0！"),!1;for(var e=0;e<$(".all-con-right").find("input").length;e++)""===$(".all-con-right").find("input").eq(e).val()&&i++;if(i>0){if(!confirm("你所填写的信息中有空白，点击确定自动补全为0或填写完整！"))return!1;for(e=0;e<$(".all-con-right").find("input").length;e++)""==$(".all-con-right").find("input").eq(e).val()&&$(".all-con-right").find("input").eq(e).val("0")}for(var l=0;l<$(".all-con-left").length;l++)for(var a=0;a<$(".all-con-right").eq(l).find(".push-details input").length;a+=5)All+=$(".all-con-left").find("input").eq(l).val()+","+$(".all-con-right").eq(l).find("input").eq(a).val()+","+$(".all-con-right").eq(l).find("input").eq(a+1).val()+","+$(".all-con-right").eq(l).find("input").eq(a+2).val()+","+$(".all-con-right").eq(l).find("input").eq(a+3).val()+","+$(".all-con-right").eq(l).find("input").eq(a+4).val()+"=";$(".button").html("已保存！")}),$("#loading").fileinput({language:"zh",uploadUrl:localhost+"/seller/pro/uploadPic",allowedFileExtensions:["jpg","png","gif"],maxFileCount:maxFileCount1,enctype:"multipart/form-data",showUpload:!0,showCaption:!1,uploadAsync:!1,browseClass:"btn btn-primary",previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadExtraData:function(n,i){var t={};return t.token=token,t.online_code=onlinecode,t}}).on("filebatchuploadsuccess",function(n,i){""===i.response.data&&void 0===i.response.data||(pic_zhu=i.response.data)}).on("filebatchuploaderror",function(n,i){"文件过大"===i.response.error&&($(" .banner-hint").html(i.response.error+"！").fadeIn(),setTimeout(function(){$(".banner-hint").fadeOut()},1200))}),$("#uploading").fileinput({language:"zh",uploadUrl:localhost+"/seller/pro/uploadPic",allowedFileExtensions:["jpg","png","gif"],maxFileCount:maxFileCount2,enctype:"multipart/form-data",showUpload:!0,showCaption:!1,uploadAsync:!1,browseClass:"btn btn-primary",previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadExtraData:function(n,i){var t={};return t.token=token,t.online_code=onlinecode,t}}).on("filebatchuploadsuccess",function(n,i){if(""!==i.response.data||void 0!==i.response.data)for(var t=(pic=i.response.data).split(","),e=0;e<t.length;e++)$(".preview-con").append('<img src="'+t[e]+'" alt="" width="100%">')}).on("filebatchuploaderror",function(n,i){"文件过大"===i.response.error&&($(" .banner-hint").html(i.response.error+"！").fadeIn(),setTimeout(function(){$(".banner-hint").fadeOut()},1200))}),$(".classify").find("input").on("input",function(){});var deliverPrice="";$(".express").click(function(){$(this).is(":checked")?(deliverPrice=null,$("select").val("选择快递模板")):deliverPrice=$("select option:selected").text()}),$("select").click(function(){"选择快递模板"===$("select option:selected").text()?(deliverPrice=null,$(".express").prop("checked",!0)):(deliverPrice=$("select option:selected").text(),$(".express").prop("checked",!1))}),$(".fabu").click(function(){var n="",i=pic,t=pic_zhu,e=$(".title").find("input").val(),l=$(".classify").find("input").val(),a=$(".kuanhao").find("input").val(),s=$(".tjbianji").find("input").val(),o=0|$(".timesInput").find("input").val(),p=($(".address .input textarea").val(),$(".kuaidi").eq(1).find("input:checked").siblings("span").html(),$(".canshu").find("input").eq(0).val(),$(".canshu").find("input").eq(1).val(),$(".canshu").find("input").eq(3).val(),$(".canshu").find("input").eq(4).val(),$(".canshu").find("input").eq(5).val(),$(".canshu").find("input").eq(6).val(),"");p=!!$("#checkBox").is(":checked"),console.log(p);for(var c=$(".pdan-start").find("input").eq(0).val()+" "+$(".pdan-start").find("input").eq(1).val()+":"+$(".pdan-start").find("input").eq(2).val()+":00",d=$(".pdan-end").find("input").eq(0).val()+" "+$(".pdan-end").find("input").eq(1).val()+":"+$(".pdan-end").find("input").eq(2).val()+":00",r=0;r<$(".choujiang").find("input").length;r++)$(".choujiang").find("input").eq(r).is(":checked")&&(n=$(".choujiang").find("input").eq(r).val());return""===e||""===l||""===deliverPrice||"选择快递模板"===deliverPrice?(alert("标题，分类，快递模板为必填项！"),!1):void 0===i||void 0===t?(alert("请先上传图片！"),!1):0===All.length?(alert("请先点击保存按钮！"),!1):void(0===push_stu&&(push_stu=1,$.post(localhost+"/seller/pro/save",{pname:e,ptypeName:l,dname:deliverPrice,pNumber:a,images:i,indexImages:t,protypes:All,invoice_type:invoice_type,token:token,online_code:onlinecode,isLuckDraw:n,suffix:s,showHours:o,issecondkill:p,killStart:c,killEnd:d,brand:"",pStyle:"",pattern:"",materialQuality:"",model:"",designPic:"",sendAddress:""},function(n){console.log(n),outline(n),null!==n.data&&"折扣价不应该大于原价"!==n.token?(alert("添加成功！"),$("input").val(""),$("textarea").val(""),$(".span").html(""),$(".kuaidi input").prop("checked",!1),$(".button").html("保存"),push_stu=0,location.href="push.html"):(alert(n.token),push_stu=0)})))});
/*2018-01-04*/