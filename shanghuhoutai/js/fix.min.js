/*By 任龙飞—renlongfei*/
function setdata(i,n){$(i).find("input").val(n)}function view(i,n){$(n).html("");for(var e=0;e<i.length;e++)$(n).append('<img src="'+i[e]+'" alt="" width="100%">')}function edit(i){$("body").on("click",i,function(){$(this).prop("readonly",!1)})}function readonly(i){$("body").on("blur",i,function(){$(this).prop("readonly",!0)})}function img_number(i){if("3"!==token)switch(i){case banner:0===(maxFileCount1=5-i.length)&&$("#loading").css({display:"none"});break;case details_img:0===(maxFileCount2=10-i.length)&&$("#uploading").css({display:"none"})}}function sort_img(i,n){$(n).html(""),i.forEach(function(i,e){$(n).append('<div class="show-img-con"><div class="last"><</div><img src="'+i+'" alt="" width=\'100%\'><div class="next">></div><div class="loading-show-img-del"><img src="images/del.png" alt="" width=\'100%\'></div></div>')})}function arrow_show(i,n,e){switch(n){case"mouseover":t=0;break;case"mouseleave":var t="-20px"}$(i).on(n,e,function(){$(this).find(".last").stop(!0).animate({left:t},300),$(this).find(".next").stop(!0).animate({right:t},300)})}function ArrChange(i,n,e){switch(i){case 0:e>0&&(n.splice(e-1,0,n[e]),n.splice(e+1,1));break;case 1:e<n.length-1&&(n.splice(e+2,0,n[e]),n.splice(e,1))}}function del_img(i,n,e){switch(e.splice(i,1),img_number(e),e){case banner:view(e,".loading-preview-con"),sort_img(e,".loading-show-img");break;case details_img:view(e,".uploading-preview-con"),sort_img(e,".uploading-show-img")}}var height=$(window).height(),push_stu=0;$(".body-left").css({height:height});var maxFileCount1=0,maxFileCount2=0,invoice_type="无",banner,details_img,All=[],pid=localStorage.getItem("fix");$.post(localhost+"/deliver/getTemplate",{sellerId:token,online_code:onlinecode},function(i){outline(i);for(var n=i.data,e=0;e<n.length;e++)$("select").append("<option>"+n[e][0].dname+"</option>")}),$.post(localhost+"/seller/pro/findOne",{pid:pid,token:token,online_code:onlinecode},function(i){outline(i);var n=i.data,e=n.produtsTypes;banner=n.indexImages.split(","),details_img=n.images.split(",");var t=[],l={},a=[];img_number(banner),img_number(details_img),setdata(".title",n.pname),setdata(".kuanhao",n.pNumber),setdata(".classify",n.ptypeName),view(banner,".loading-preview-con"),view(details_img,".uploading-preview-con"),sort_img(banner,".loading-show-img"),sort_img(details_img,".uploading-show-img"),e.forEach(function(i,n){l[i.color]||(t.push(i.color),l[i.color]=1)}),t.forEach(function(i,n){e.forEach(function(n,e){i===n.color&&(a.push({}),a[e].color=n.color,a[e].amount=n.amount,a[e].priceNew=n.priceNew,a[e].size=n.size,a[e].discountPrice=n.discountPrice)})}),t.forEach(function(i,n){$(".sure").append('<div class="all">\n                <div class="all-top">\n                    <ul>\n                        <li style="width: 90px">颜色</li>\n                        <li>尺码</li>\n<li style="position: relative" class="djia"><span style="cursor: pointer">折扣价<span style="font-size: 12px;display: block">(双击一键添加)</span></span><input type="text" style="height: 100%;width: 64%;position: absolute;left:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center"></li>                        <li style="position: relative" class="jia">\n                            <span style="cursor: pointer;display: block">原价\n                                <span style="font-size: 12px">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                        <li style="position: relative" class="cunliang">\n                            <span>库存\n                                <span style="font-size: 12px;display: block">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                    </ul>\n                </div>\n                <div class="all-con">\n                    <div class="all-con-left">\n                        <input type="text"  readonly class="clickdb">\n                    </div>\n                    <div class="all-con-right">\n                        <ul>\n                        </ul>\n<div class="add_"><img src="images/add.png" alt=""></div>                    </div>\n                    <div class="del">\n                        <img src="images/del.png" alt="">\n                    </div>\n                </div>\n            </div>'),$(".all").eq(n).find(".all-con-left input").val(i),a.forEach(function(e,t){i===e.color&&$(".all").eq(n).find(".all-con-right ul").eq(0).append('<li>\n                                <ul class="push-details">\n                                    <li><span>\n                                      <input type="text" placeholder=\'列如："S"\' class="chima" readonly value='+a[t].size+'>\n                                </span></li>\n                <li><input type="text" readonly class="clickdb disjiage" value='+a[t].discountPrice+'></li><li><input type="text" readonly class="clickdb jiage" value='+a[t].priceNew+'></li> <li><input type="text" readonly class="clickdb nums" value='+a[t].amount+'></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>')})}),$(".address").find("textarea").val(n.sendAddress),$.post(localhost+"/ptypename/list",{sellerId:token,online_code:onlinecode},function(i){if(outline(i),null!==i.data){for(var n=i.data.ptypename.split(","),e=0;e<n.length;e++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+n[e]+"</span></div>");arrow_show(".span","mouseover",".span-span"),arrow_show(".span","mouseleave",".span-span"),$(".span").on("click",".last",function(){var i=$(this).parents(".span-span").index();ArrChange(0,n,i),$(".span").html("");for(var e=0;e<n.length;e++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+n[e]+"</span></div>");return!1}),$(".span").on("click",".next",function(){var i=$(this).parents(".span-span").index();ArrChange(1,n,i),$(".span").html("");for(var e=0;e<n.length;e++)$(".span").append('<div class="span-span"><div class="last"><</div><div class="next">></div><span>'+n[e]+"</span></div>");return!1}),$(".button").click(function(){$.post(localhost+"/ptypename/save",{id:i.data.id,sellerId:token,ptypename:n.join(",")},function(i){})})}}),$(".span").on("click",".span-span",function(){$(".span").siblings(".classify").find("input").val($(this).find("span").text())}),arrow_show(".loading-show-img","mouseover",".show-img-con"),arrow_show(".uploading-show-img","mouseover",".show-img-con"),arrow_show(".loading-show-img","mouseleave",".show-img-con"),arrow_show(".uploading-show-img","mouseleave",".show-img-con"),$(".loading-show-img").on("click",".last",function(){var i=$(this).parents(".show-img-con").index();ArrChange(0,banner,i),view(banner,".loading-preview-con"),sort_img(banner,".loading-show-img")}),$(".loading-show-img").on("click",".next",function(){var i=$(this).parents(".show-img-con").index();ArrChange(1,banner,i),view(banner,".loading-preview-con"),sort_img(banner,".loading-show-img")}),$(".uploading-show-img").on("click",".last",function(){var i=$(this).parents(".show-img-con").index();ArrChange(0,details_img,i),view(details_img,".uploading-preview-con"),sort_img(details_img,".uploading-show-img")}),$(".uploading-show-img").on("click",".next",function(){var i=$(this).parents(".show-img-con").index();ArrChange(1,details_img,i),view(details_img,".uploading-preview-con"),sort_img(details_img,".uploading-show-img")}),$("body").on("click",".loading-show-img-del",function(){var i=$(this).parents().parents()[0].className,n=$(this).parents().index();switch(i){case"loading-show-img":del_img(n,".show-img-con",banner),img_number(banner);break;case"uploading-show-img":del_img(n,".show-img-con",details_img),img_number(details_img)}}),edit(".chima"),readonly(".chima"),edit(".clickdb"),readonly(".clickdb"),$("body").on("click",".del",function(){$(".del").length>1&&$(this).parents(".all").remove()}),$("body").on("click",".del_",function(){$(this).parents(".all-con-right").find(".push-details").length>1&&$(this).parents(".push-details").parents("li").remove()}),$("body").on("click",".all-top .jia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("click",".all-top .djia",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .jia",function(){var i=$(this).find("input").val(),n=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(n).find(".jiage").val(i)}),$("body").on("blur",".all-top .djia",function(){var i=$(this).find("input").val(),n=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(n).find(".disjiage").val(i)}),$("body").on("click",".all-top .cunliang",function(){$(this).find("input").css({opacity:1}).siblings("span").css({opacity:0})}),$("body").on("blur",".all-top .cunliang",function(){var i=$(this).find("input").val(),n=$(this).parents(".all").index();$(this).find("input").css({opacity:0}).siblings("span").css({opacity:1}),$(".all-con-right").eq(n).find(".nums").val(i)}),$("body").on("click",".add_",function(){$(this).siblings("ul").append('<li>\n                                <ul class="push-details">\n                                    <li><span>\n                                      <input type="text" placeholder=\'列如："S"\' class="chima">\n                                </span></li>\n                <li><input type="text" readonly class="clickdb disjiage"></li><li><input type="text" readonly class="clickdb jiage"></li> <li><input type="text" readonly class="clickdb nums"></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>')}),$(".add").click(function(){$(".sure").append('<div class="all">\n                <div class="all-top">\n                    <ul>\n                        <li style="width: 90px">颜色</li>\n                        <li>尺码</li>\n<li style="position: relative" class="djia"><span style="cursor: pointer">折扣价<span style="font-size: 12px;display: block">(双击一键添加)</span></span><input type="text" style="height: 100%;width: 64%;position: absolute;left:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center"></li>                        <li style="position: relative" class="jia">\n                            <span style="cursor: pointer;display: block">原价\n                                <span style="font-size: 12px">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                        <li style="position: relative" class="cunliang">\n                            <span>库存\n                                <span style="font-size: 12px;display: block">(双击一键添加)</span>\n                            </span>\n                            <input type="text" style="height: 100%;width: 64%;position: absolute;\nleft:0;top:0;margin-left: 25px;opacity: 0;cursor: pointer;text-align: center">\n                        </li>\n                    </ul>\n                </div>\n                <div class="all-con">\n                    <div class="all-con-left">\n                        <input type="text"  readonly class="clickdb">\n                    </div>\n                    <div class="all-con-right">\n                        <ul>\n<li>\n                                <ul class="push-details">\n                                    <li><span>\n                                      <input type="text" placeholder=\'列如："S"\' class="chima">\n                                </span></li>\n                <li><input type="text" readonly class="clickdb disjiage"></li><li><input type="text" readonly class="clickdb jiage"></li> <li><input type="text" readonly class="clickdb nums"></li><div class="del_"><img src="images/del.png" alt=""></div>                                </ul>\n                            </li>                        </ul>\n<div class="add_"><img src="images/add.png" alt=""></div>                    </div>\n                    <div class="del">\n                        <img src="images/del.png" alt="">\n                    </div>\n                </div>\n            </div>')}),$(".sure").on("input","input",function(){All=[],$(".button").html("保存")}),$(".button").click(function(){try{$(".sure").find(".all-con-left input").each(function(i,n){if(""===n.value)return alert("有颜色栏未填写，如不需要请点击右上角删除！"),!1})}catch(i){}try{$(".sure").find(".all-con-right span input").each(function(i,n){if(""===n.value)return alert("有尺寸栏未填写，如不需要请点击右上角删除！"),!1})}catch(i){}All=[];for(var i=0,n=0;n<$(".disjiage").length;n++)if($(".disjiage").eq(n).val()<=0)return alert("折扣价不得为0！"),!1;for(e=0;e<$(".all-con-right").find("input").length;e++)""==$(".all-con-right").find("input").eq(e).val()&&i++;if(i>0){if(!confirm("你所填写的信息中有空白，点击确定自动补全为0或填写完整！"))return!1;for(var e=0;e<$(".all-con-right").find("input").length;e++)""==$(".all-con-right").find("input").eq(e).val()&&$(".all-con-right").find("input").eq(e).val("0")}for(var t=0;t<$(".all-con-left").length;t++)for(var l=0;l<$(".all-con-right").eq(t).find(".push-details input").length;l+=4)All+=$(".all-con-left").find("input").eq(t).val()+","+$(".all-con-right").eq(t).find("input").eq(l).val()+","+$(".all-con-right").eq(t).find("input").eq(l+1).val()+","+$(".all-con-right").eq(t).find("input").eq(l+2).val()+","+$(".all-con-right").eq(t).find("input").eq(l+3).val()+"=";$(".button").html("已保存！")}),$("body").on("click",".btn",function(){"none"===$("#loading").css("display")&&($(".hint-page").fadeIn().html("图片数量已打上限，请删除后重试！"),setTimeout(function(){$(".hint-page").fadeOut().html("")},1500))}),$("#loading").fileinput({language:"zh",uploadUrl:localhost+"/seller/pro/uploadPic",allowedFileExtensions:["jpg","png","gif"],maxFileCount:maxFileCount1,enctype:"multipart/form-data",showUpload:!0,showCaption:!1,uploadAsync:!1,browseClass:"btn btn-primary",previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadExtraData:function(i,n){var e={};return e.token=token,e.online_code=onlinecode,e}}).on("filebatchuploadsuccess",function(i,n){""===n.response.data&&void 0===n.response.data||(n.response.data.split(",").forEach(function(i,n){banner.push(i)}),img_number(banner),sort_img(banner,".loading-show-img"),view(banner,".loading-preview-con"))}),$("#uploading").fileinput({language:"zh",uploadUrl:localhost+"/seller/pro/uploadPic",allowedFileExtensions:["jpg","png","gif"],maxFileCount:maxFileCount2,enctype:"multipart/form-data",showUpload:!0,showCaption:!1,uploadAsync:!1,browseClass:"btn btn-primary",previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadExtraData:function(i,n){var e={};return e.token=token,e.online_code=onlinecode,e}}).on("filebatchuploadsuccess",function(i,n){""===n.response.data&&void 0===n.response.data||(n.response.data.split(",").forEach(function(i,n){details_img.push(i)}),img_number(details_img),sort_img(details_img,".uploading-show-img"),view(details_img,".uploading-preview-con"))}),$(".classify").find("input").on("input",function(){});var s="";$(".express").click(function(){$(this).is(":checked")?(s=null,$("select").val("选择快递模板")):s=$("select option:selected").text()}),$("select").click(function(){"选择快递模板"===$("select option:selected").text()?(s=null,$(".express").prop("checked",!0)):(s=$("select option:selected").text(),$(".express").prop("checked",!1))}),$(".fabu").click(function(){for(var i="",e=details_img.join(","),t=banner.join(","),l=$(".title").find("input").val(),a=$(".classify").find("input").val(),o=$(".kuanhao").find("input").val(),c=$(".tjbianji").find("input").val(),p=($(".address .input textarea").val(),$(".kuaidi").eq(1).find("input:checked").siblings("span").html(),$(".canshu").find("input").eq(0).val(),$(".canshu").find("input").eq(1).val(),$(".canshu").find("input").eq(3).val(),$(".canshu").find("input").eq(4).val(),$(".canshu").find("input").eq(5).val(),$(".canshu").find("input").eq(6).val(),0);p<$(".choujiang").find("input").length;p++)$(".choujiang").find("input").eq(p).is(":checked")&&(i=$(".choujiang").find("input").eq(p).val());return""===l||""===a||""===s||"选择快递模板"===s?(alert("标题，分类，快递模板为必填项！"),!1):void 0===e||void 0===t?(alert("请先上传图片！"),!1):0===All.length?(alert("请先点击保存按钮！"),!1):void(0===push_stu&&(push_stu=1,$.post(localhost+"/seller/pro/save",{id:pid,monthSale:n.monthSale,thumbsup:n.thumbsup,active:n.active,pname:l,ptypeName:a,pNumber:o,images:e,indexImages:t,protypes:All,invoice_type:invoice_type,dname:s,token:token,online_code:onlinecode,isLuckDraw:i,suffix:c,qrcode:n.qrcode,sendAddress:"",brand:"",pStyle:"",pattern:"",materialQuality:"",model:"",designPic:""},function(i){outline(i),null!==i.data&&"折扣价不应该大于原价"!==i.token?(alert("更新成功！"),$("input").val(""),$("textarea").val(""),$(".span").html(""),$(".kuaidi input").prop("checked",!1),$(".button").html("保存"),push_stu=0,location.href="charge.html"):(alert(i.token),push_stu=0)})))})});
/*2017-12-28*/