/*By 任龙飞—renlongfei*/
var amount_=[],saleNumber_=[],content,pages=0,pagesindex=0,showlist=[],enlist=[],dename=[],style_="/tuan/product/list",details_={pageNumber:pages,pageSize:10,saleId:token,active:!0,online_code:onlinecode},nums=0;"0"===authority&&($(".body-top ul li:gt(0)").css({display:"none"}),$(".body-top ul").css({background:"#18cffb"})),$("body").on("click",".edit",function(){""===$(this).attr("title")?($(this).siblings(".details-details").stop(!0).slideDown(),$(this).prop("title","编辑")):($(this).siblings(".details-details").stop(!0).slideUp(),$(this).prop("title",""))});function chageStyle(s,e,t){console.log(this),2===arguments.length?(this.style_=s,this.details_={pageNumber:pages,pageSize:10,saleId:token,active:!0,online_code:onlinecode},this.html_=e):(this.style_=s,this.details_={pageNumber:pages,pageSize:10,saleId:token,active:!0,state:t,online_code:onlinecode},this.html_=e)}function addhtml1_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有待拼订单！"),!1;for(var e=[],t=0;t<s.length;t++){var a=s[t].products.indexPic.split(",")[0],i=0;s[t].products.productsTypes.forEach(function(s,e){i+=s.amount}),e.push(i),$(".all").append('<div class="details">\n    <div class="details-left">\n           <img src="'+a+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>团购订单号：'+s[t].iterable[0].groupCode+"  </br>  个人订单号："+s[t].iterable[0].code+"</div>\n"+s[t].products.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[t].products.productsTypes[0].color+'</span>\n<span class="chima">尺码：'+s[t].products.productsTypes[0].size+'</span>\n</div>\n<div class="price price-charge">\n标价：￥<span style="color:black;text-decoration: none">'+s[t].products.productsTypes[0].tuanPrice+'</div>\n    <span class="nums num">\n剩余库存：'+e[0]+"    已卖出： "+s[t].products.saleNum+'\n</span>\n</div>\n<div class="details-right-charge">\n<div class="fahuo revise-price" title="">\n更多\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul-wait-pin"></div></div></div>\n    </div>');for(var n=s[t].iterable,l=0;l<n.length;l++){var d=n[l].endDate;d=(d=new Date(Date.parse(d.replace(/-/g,"/")))).getTime();$(".details-ul-wait-pin").eq(t).append('<ul><li class="wait-pin"><div>拼主：<span>'+n[l].owner+'</span></div><div>还差<span style="color:red">'+(n[l].startNum-n[l].joinNum)+'</span>人</div><div>剩余时间：<span style="color:red">'+function(s){var e=s-Date.now(),t=Math.floor(e/36e5),a=e-3600*t*1e3,i=Math.floor(a/6e4),n=(a-60*i*1e3)/1e3;return t.toString()+": "+i.toString()+": "+n.toFixed(2)}(d)+"</span></div></li></ul>")}}}function addhtml2_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有已发货个人订单！"),!1;$(".all").append('<div class="choice-query-form"><div class="allChoice"><input class="all-choice" type="checkbox" name="allChoice" />全选&nbsp;&nbsp;</div><div class="queryOrder">查询订单</div><div class="generateTable">生成表格</div></div>');for(var e=0;e<s.length;e++){var t=s[e].tProducts.indexPic.split(",")[0],a=0;s[e].tProducts.productsTypes.forEach(function(s,e){a+=s.amount}),amount_.push(a),$(".all").append('<div class="details">\n<div class="oNum" style="display:none;">'+s[e].id+'</div><div class="data"><input type="checkbox" class="checkbox"/>&nbsp;<span> 订单号：'+s[e].code+"</span>&nbsp;&nbsp;<span>成交时间："+s[e].tDeliver.createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+t+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>订单号：'+s[e].code+"</div>\n"+s[e].tProducts.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[e].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+s[e].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge">\n售价：￥'+s[e].totalPrice+'    </div>\n    <span class="nums num">\n剩余库存：'+amount_[0]+"已卖出： "+s[e].saleNum+'\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+s[e].tDeliver.receiver+s[e].tDeliver.phone+"<br>\n"+s[e].tDeliver.address+'</div>\n<div class="status">\n待签收 '+s[e].amount+"件 总价："+s[e].totalPrice+'</div>\n<div class="data" style="border:none;">\n'+s[e].createDate+'</div>\n<div class="fahuo wuliu-details" title="">\n查看物流详情\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><ul><li>'+s[e].tDeliver.dname+"</li><li>"+s[e].tDeliver.dcode+"</li></ul></div></div></div>\n    </div>")}}function addhtml3_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有未发货个人订单！"),!1;$(".all").append('<div class="choice-query-form"><div class="allChoice"><input class="all-choice" type="checkbox" name="allChoice" />全选&nbsp;&nbsp;</div><div class="queryOrder">查询订单</div><div class="generateTable">生成表格</div></div>');for(var e=[],t=0;t<s.length;t++){var a=s[t].tProducts.indexPic.split(",")[0],i=0;s[t].tProducts.productsTypes.forEach(function(s,e){i+=s.amount}),e.push(i),$(".all").append('<div class="details">\n<div class="oNum" style="display:none;">'+s[t].id+'</div><div class="data"><input type="checkbox" class="checkbox"/>&nbsp;<span> 订单号：'+s[t].code+"</span>&nbsp;&nbsp;<span>成交时间："+s[t].tDeliver.createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+a+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>订单号：'+s[t].code+"</div>\n"+s[t].tProducts.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[t].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+s[t].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge">\n<div class="status">\n总价：'+s[t].totalPrice+'</div>\n    </div>\n    <span class="nums num">\n剩余库存：'+e[0]+'<span style="margin-left: 30px">已卖出：'+s[t].tProducts.saleNum+'</span>\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n<span class="deliverId" style="display:none">'+s[t].tDeliver.id+"</span>"+s[t].tDeliver.receiver+s[t].tDeliver.phone+"<br>\n"+s[t].tDeliver.address+'</div>\n<div class="data" style="border:none;">\n'+s[t].createDate+"<br><span>待发货数量："+s[t].amount+'</span></div>\n<div class="fahuo" title="">\n发货\n</div>\n</div>\n<div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><div><input type="text" class="details-ul-input" placeholder="物流公司"></div><ul></ul></div><span class="oid" style="display: none">'+s[t].id+'</span><div class="express"><input type="text" placeholder="物流订单号"></div><div class="express-sure">确定发货</div></div></div>\n</div>')}}function addhtml5_(s){if($(".all").html(""),0===s.length)return $(".all").html("您没有已完成的个人订单！"),!1;$(".all").append('<div class="choice-query-form"><div class="allChoice"><input class="all-choice" type="checkbox" name="allChoice" />全选&nbsp;&nbsp;</div><div class="queryOrder">查询订单</div><div class="generateTable">生成表格</div></div>');for(var e=0;e<s.length;e++){var t=s[e].tProducts.indexPic.split(",")[0],a=0;s[e].tProducts.productsTypes.forEach(function(s,e){a+=s.amount}),amount_.push(a),$(".all").append('<div class="details">\n<div class="oNum" style="display:none;">'+s[e].id+'</div><div class="data"><input type="checkbox" class="checkbox"/>&nbsp;<span> 订单号：'+s[e].code+"</span>&nbsp;&nbsp;<span>成交时间："+s[e].tDeliver.createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+t+'" alt="">\n    </div>\n    <div class="details-con width">\n    <div class="details-con-top">\n<div>订单号：'+s[e].code+"</div>\n"+s[e].tProducts.pname+'</div>\n<div class="style">\n<span class="yanse">颜色：'+s[e].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+s[e].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge" style="color:red">\n售价：￥'+s[e].totalPrice+'  &nbsp&nbsp<span style="text-decoration: line-through;color:#999;">'+s[e].tProductsTypes.newPrice+'</span>    </div>\n    <span class="nums num">\n剩余库存：'+amount_[0]+"已卖出： "+s[e].tProducts.saleNum+'\n</span>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n'+s[e].tDeliver.receiver+s[e].tDeliver.phone+"<br>\n"+s[e].tDeliver.address+'</div>\n<div class="data">\n'+s[e].createDate+'<div class="status">\n已完成 '+s[e].amount+"件 总价："+s[e].totalPrice+"</div>\n</div>\n</div>\n    </div>")}}function addhtml6_(s){$(".all").html(""),0===s.length||null===s?$(".all").append("您没有未发货的团购订单"):($(".all").append('<div class="choice-query-form"><div class="allChoice"><input class="all-choice" type="checkbox" name="allChoice" />全选&nbsp;&nbsp;</div><div class="queryOrder">查询订单</div><div class="tuan-generateTable">生成表格</div></div>'),s.forEach(function(s,e){var t=[],a={},i=0;s.tuanOrdersList.forEach(function(s,e){a[s.groupCode]||(t.push(s.groupCode),a[s.groupCode]=1)}),s.products.productsTypes.forEach(function(s,e){i+=s.amount}),[].push(i);for(var n=s.products.indexPic.split(",")[0],l=0;l<t.length;l++)for(var d=s.tuanOrdersList,o=0;o<d.length;o++)d[o].groupCode===t[l]&&(null==d[o].leavemsg&&(d[o].leavemsg=""),$(".all").append('<div class="details">\n<div class="oNum" style="display:none;">'+d[o].id+'</div><div class="data"><input type="checkbox" class="checkbox"/>&nbsp;<span>团购号：'+t[l]+"</span>&nbsp;&nbsp;<span> 订单号："+d[o].code+"</span>&nbsp;&nbsp;<span>成交时间："+d[o].tDeliver.createDate+'</span></div>\n    <div class="details-left">\n           <img src="'+n+'" alt="">\n    </div>\n    <div class="details-con width">\n    <p class="details-con-top">\n'+s.products.pname+'</p>\n<div class="style">\n<span class="yanse">颜色：'+d[o].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+d[o].tProductsTypes.size+'</span>\n</div>\n<div class="price price-charge">\n<div class="status">\n总价：'+d[o].totalPrice+'<span style="margin-left:30px;">数量：'+d[o].amount+'</span></div>\n    </div>\n</div>\n<div class="details-right-charge">\n    <div class="address">\n<span class="dliverid" style="display:none">'+d[o].id+"</span>"+d[o].tDeliver.receiver+d[o].tDeliver.phone+"<br>\n"+d[o].tDeliver.address+'</div>\n<div style="width:70%;font-size:14px;margin-top:5px">买家备注：<span style="color:blue">'+d[o].leavemsg+'</span></div></div>\n<div class="fahuo" title="">\n发货\n</div>\n<div class="tmjbeizhu"><div class="con">卖家备注：<input type="text" placeholder="请填写备注"><button class="tianxie">确定备注</button ></div><div class="id" style="display:none">'+d[o].tDeliver.id+'</div></div><div class="details-details-cons"><div class="details-details-con"><div class="details-ul"><div><input type="text" class="details-ul-input" placeholder="物流公司"></div><ul></ul></div><span class="oid" style="display: none">'+d[o].tDeliver.id+'</span><div class="express"><input type="text" placeholder="物流订单号"></div><div class="fahuo-geren">确定发货</div></div></div>\n</div>'))}))}function addhtml7_(s){$(".all").html(""),0===s.length||null===s?$(".all").append("您没有已发货的团购订单"):($(".all").append('<div class="choice-query-form"><div class="allChoice"><input class="all-choice" type="checkbox" name="allChoice" />全选&nbsp;&nbsp;</div><div class="queryOrder">查询订单</div><div class="tuan-generateTable">生成表格</div></div>'),s.forEach(function(s,e){var t=[],a={},i=0;s.tuanOrdersList.forEach(function(s,e){a[s.groupCode]||(t.push(s.groupCode),a[s.groupCode]=1)}),s.products.productsTypes.forEach(function(s,e){i+=s.amount}),[].push(i);var n=s.products.indexPic.split(",")[0];console.log(s);for(var l=s.tuanOrdersList,d=0;d<l.length;d++)$(".all").append('<div class="details"><div class="oNum" style="display:none;">'+l[d].id+'</div><div class="details-top"><input type="checkbox" class="checkbox"/>&nbsp;<span>团购号：'+l[d].groupCode+"</span>&nbsp;&nbsp;<span>订单号："+l[d].code+"</span> &nbsp;&nbsp;<span>成交时间："+l[d].tDeliver.createDate+'</span></div><div class="details-left"> <img src="'+n+'" alt=""></div><div class="details-con width"> <div class="details-con-top">'+s.products.pname+' </div> <div class="price price-charge price-tuan">'+s.products.productsTypes[0].tuanPrice+"<span>￥"+s.products.productsTypes[0].newPrice+'</span></div><span class="yanse">颜色：'+l[d].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+l[d].tProductsTypes.size+"</span>\n<span>已发货 "+l[d].amount+"件 总价"+l[d].totalPrice+'</span> </div><div class="details-right-charge">\n    <div class="address">\n<span class="dliverid" style="display:none">'+l[d].id+"</span>"+l[d].tDeliver.receiver+l[d].tDeliver.phone+"<br>\n"+l[d].tDeliver.address+'</div>\n<div style="width:70%;font-size:14px;margin-top:5px">买家备注：<span style="color:blue">'+l[d].leavemsg+"</span></div><p>卖家备注："+l[d].leavemsg2+'</p><div class="wuliu" ><span>物流公司：'+l[d].tDeliver.dname+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>物流单号："+l[d].tDeliver.dcode+"</span></div></div>")}))}function addhtml8_(s){$(".all").html(""),0===s.length||null===s?$(".all").append("您没有已完成的团购订单"):($(".all").append('<div class="choice-query-form"><div class="allChoice"><input class="all-choice" type="checkbox" name="allChoice" />全选&nbsp;&nbsp;</div><div class="queryOrder">查询订单</div><div class="tuan-generateTable">生成表格</div></div>'),s.forEach(function(s,e){var t=[],a={},i=0;s.tuanOrdersList.forEach(function(s,e){a[s.groupCode]||(t.push(s.groupCode),a[s.groupCode]=1)}),s.products.productsTypes.forEach(function(s,e){i+=s.amount}),[].push(i);for(var n=s.products.indexPic.split(",")[0],l=s.tuanOrdersList,d=0;d<l.length;d++)$(".all").append('<div class="details"><div class="oNum" style="display:none;">'+l[d].id+'</div><div class="details-top"><input type="checkbox" class="checkbox"/>&nbsp;<span>团购号：'+l[d].groupCode+"</span>&nbsp;&nbsp;<span>订单号："+l[d].code+"</span> &nbsp;&nbsp;<span>成交时间："+l[d].tDeliver.createDate+'</span></div><div class="details-left"> <img src="'+n+'" alt=""></div><div class="details-con width"> <div class="details-con-top">'+s.products.pname+' </div> <div class="price price-charge price-tuan">'+s.products.productsTypes[0].tuanPrice+"<span>￥"+s.products.productsTypes[0].newPrice+'</span></div><span class="yanse">颜色：'+l[d].tProductsTypes.color+'</span>\n<span class="chima">尺码：'+l[d].tProductsTypes.size+"</span>\n<span>已完成 "+l[d].amount+"件 总价"+l[d].totalPrice+'</span> </div><div class="details-right-charge">\n    <div class="address">\n<span class="dliverid" style="display:none">'+l[d].id+"</span>"+l[d].tDeliver.receiver+l[d].tDeliver.phone+"<br>\n"+l[d].tDeliver.address+'</div>\n<div style="width:70%;font-size:14px;margin-top:5px">买家备注：<span style="color:blue">'+l[d].leavemsg+"</span></div><p>卖家备注："+l[d].leavemsg2+'</p><div class="wuliu" ><span>物流公司：'+l[d].tDeliver.dname+"</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>物流单号："+l[d].tDeliver.dcode+"</span></div></div>")}))}$(".body-top ul li").click(function(){var s=$(this).index();switch(pages=0,$(".all").html(""),s){case 0:$.post(localhost+"/tuan/tuanorders/tuaning_list",{saleId:token,online_code:onlinecode},function(s){outline(s);var e=s.data;addhtml1_(e),0===e.length?$(".pages").hide():$(".pages").show()})}}),$("body").on("click",".tuan",function(s){var e=$(this).parents("li").index();switch(pages=0,e){case 1:$.post(localhost+"/tuan/tuanorders/list",{saleId:token,state:"待发货团购订单",online_code:onlinecode},function(s){outline(s);var e=s.data;addhtml6_(e),0===e.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/tuanorders/list",addhtml6_,"待发货团购订单");break;case 2:return $.post(localhost+"/tuan/tuanorders/list",{saleId:token,state:"待收货团购订单",online_code:onlinecode},function(s){outline(s);var e=s.data;addhtml7_(e),0===e.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/tuanorders/list",addhtml7_,"待收货团购订单"),!1;case 3:$.post(localhost+"/tuan/tuanorders/list",{saleId:token,state:"已完成团购订单",showsale:!0,online_code:onlinecode},function(s){outline(s);var e=s.data;addhtml8_(e),0===e.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/tuanorders/list",addhtml8_,"已完成团购订单")}return!1}),$("body").on("click",".person",function(){var s=$(this).parents("li").index();switch(pages=0,console.log($(this)),s){case 1:$.post(localhost+"/tuan/torders/list",{saleId:token,state:"待发货订单",online_code:onlinecode},function(s){outline(s);var e=s.data.content;addhtml3_(e),0===e.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/torders/list",addhtml3_,"待发货订单");break;case 2:$.post(localhost+"/tuan/torders/list",{saleId:token,state:"待收货订单",online_code:onlinecode},function(s){outline(s);var e=s.data.content;addhtml2_(e),0===e.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/torders/list",addhtml2_,"待收货订单");break;case 3:$.post(localhost+"/tuan/torders/list",{saleId:token,state:"已完成订单",showsale:!0,online_code:onlinecode},function(s){outline(s);var e=s.data.content;addhtml5_(e),0===e.length?$(".pages").hide():$(".pages").show()}),chageStyle("/tuan/torders/list",addhtml5_,"已完成订单")}}),$.post(localhost+"/tuan/tuanorders/tuaning_list",{saleId:token,online_code:onlinecode},function(s){outline(s);var e=s.data;addhtml1_(e),0===e.length?$(".pages").hide():$(".pages").show()}),$("body").on("click",".sure-price",function(){var s=$(this).siblings("input").val();if(""!==s&&/^\d{0,8}\.{0,1}(\d{1,2})?$/.test(s)){var e=$(this).siblings(".id").html(),t=$(this).parents(".details").find(".active").html(),a=$(this).parents(".details").find(".amount").html(),i=$(this);$.post(localhost+"/tuan/produttypes/update",{saleId:token,id:e,active:t,newPrice:s,amount:a,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message?(i.parents(".list").find(".newPrice").text(s),i.siblings("input").val("")):alert("未修改成功！")})}}),$("body").on("click",".sure-nums",function(){var s=$(this).siblings("input").val();if(""!==s){var e=$(this).siblings(".id").html(),t=$(this).parents(".details").find(".active").html(),a=$(this).parents(".details").find(".newPrice").html(),i=$(this);$.post(localhost+"/tuan/produttypes/update",{saleId:token,id:e,active:t,amount:s,newPrice:a,online_code:onlinecode},function(e){outline(e),"操作成功"===e.message?(i.parents("span").siblings("span").eq(4).html(s),i.siblings("input").val("")):alert("未修改成功！")})}}),$("body").on("click",".del",function(){var s=$(this).parents(".details").find(".produt-id span").text(),e=$(this).parents(".details").index(),t=$(this).parents(".list").index()-1,a=$(this).find(".id").html(),i=$(this).parents(".list").find(".amount").html(),n=$(this).parents(".list").find(".newPrice").html();$(this);$.post(localhost+"/tuan/produttypes/update",{saleId:token,id:a,active:!1,amount:i,newPrice:n,online_code:onlinecode},function(a){outline(a),"操作成功"===a.message&&$(".details").eq(e).find(".list").eq(t).remove(),0===$(".details").eq(e).find(".del").length&&$.post(localhost+"/tuan/product/update",{saleId:token,id:s,active:!1,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(e).remove()}),0===$(".details").length&&$(".pages").hide()})}),$("body").on("click",".down",function(){var s=$(this).parents(".details").find(".produt-id span").text(),e=$(this).parents(".details").index();$.post(localhost+"/tuan/product/update",{saleId:token,id:s,active:!1,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&$(".details").eq(e).remove()})}),$("body").on("click",".fix",function(){var s=$(this).parents(".details").find(".produt-id span").text(),e=$(this).parents(".details").find(".active").text();console.log(s),localStorage.setItem("fix",s),localStorage.setItem("isactive",e),location.href="fix_pin.html"}),$("body").on("click",".shangjia",function(){var s=$(this).parents(".details").find(".id_id").text(),e=$(this);$.post(localhost+"/tuan/product/update",{saleId:token,id:s,active:!0,online_code:onlinecode},function(s){outline(s),"操作成功"===s.message&&(alert("上架成功！"),e.parents(".details").remove())})});function findlist(s,e,t){for(var a=[],i=0;i<s.length;i++)a.push(s[i].indexOf(t));for(var n=0;n<a.length;n++)a[n]>=0&&(showlist.push(s[n]),enlist.push(e[n]))}$(".all").on("click","input.all-choice",function(){$(this).is(":checked")?$(this).parents(".all").find(".details .checkbox").prop("checked",!0):$(this).parents(".all").find(".details .checkbox").prop("checked",!1)}),$(".all").on("click",".details .checkbox",function(){$(this).is(":checked")||$(this).parents(".all").find("input.all-choice").prop("checked",!1)}),$(".all").on("click",".generateTable",function(){var s=[];$(this).parents(".all").find(".details .checkbox").each(function(){$(this).is(":checked")&&s.push($(this).parents(".details").find(".oNum").text())}),console.log(s),0===s.length?alert("请选择订单"):$.post(localhost+"/tuan/torders/excel",{saleId:token,oids:s.join("=")},function(s){s.error?alert(s.message):null!==s.data?location.href=s.data:alert("数据错误！")})}),$(".all").on("click",".tuan-generateTable",function(){var s=[];$(this).parents(".all").find(".details .checkbox").each(function(){$(this).is(":checked")&&s.push($(this).parents(".details").find(".oNum").text())}),0===s.length?alert("请选择订单"):$.post(localhost+"/tuan/tuanorders/excel",{saleId:token,oids:s.join("=")},function(s){s.error?alert(s.message):null!==s.data?location.href=s.data:alert("数据错误！")})}),$("body").on("click",".fahuo",function(){""===$(this).attr("title")?($(this).parents(".details").find(".details-details-cons").stop(!0).slideDown(),$(this).prop("title","发货")):($(this).parents(".details").find(".details-details-cons").stop(!0).slideUp(),$(this).prop("title",""))}),$(".all").on("click",".order-img",function(){var stu=!0===eval($(this).prop("title"));$(this).prop("title",!stu),stu?($(this).css({transform:"rotate(180deg)"}),$(this).parent(".ordernumber-tuan").next(".details-details-cons-tuan-cons").slideDown()):($(this).css({transform:" rotate(0deg)"}),$(this).parent(".ordernumber-tuan").next(".details-details-cons-tuan-cons").slideUp())}),$(".all").on("click",".fahuo-tuan-ready input",function(){var stu=!0===eval($(this).prop("name"));$(this).prop("name",!stu),stu?($(this).val("隐藏"),$(this).parents(".details").find(".details-details-cons").slideDown()):($(this).val("查看物流"),$(this).parents(".details").find(".details-details-cons").slideUp())}),$(".all").on("click",".show-express input",function(){var stu=!0===eval($(this).prop("name"));$(this).prop("name",!stu);var dcode=$(this).parent(".show-express").siblings(".details-details-cons-tuan-express-con").find(".dcode").text();stu?$(this).parents(".show-express").next(".details-details-cons-tuan-express-con").slideDown():$(this).parents(".show-express").next(".details-details-cons-tuan-express-con").slideUp()}),$("body").on("input",".details-ul-input",function(){showlist=[],enlist=[];var s=$(this).val();$(this).parents().siblings(".details-ul ul").html("");/^[\u4E00-\u9FA5]+$/.test(s)&&findlist(list_zh,list_en,s);for(var e=0;e<showlist.length;e++)$(this).parents().siblings(".details-ul ul").append("<li>"+showlist[e]+"</li>");""===s&&$(this).parents().siblings(".details-ul ul").html("")}),$("body").on("click",".details-ul li",function(){(dename=[]).push(enlist[$(this).index()]),$(this).parents(".details-ul ul").siblings("div").find(".details-ul-input").val($(this).text()),$(this).parents(".details-ul ul").html("")}),$("body").on("click",".express-sure",function(){var s=$(this).parents(".details").index(),e=$(this).siblings(".oid").text(),t=$(this).siblings(".express").find("input").val(),a=$(this).siblings(".details-ul").find("input").val(),i=$(this).parents(".details").find(".deliverId").html();$.post(localhost+"/tuan/tdeliver/update",{id:i,oid:e,saleId:token,dcode:t,dname:a,online_code:onlinecode},function(t){outline(t),1==t.error?alert(t.message):"操作成功"===t.message&&(alert(t.message),$.post(localhost+"/tuan/torders/changestate",{oid:e,state:"待收货订单",saleId:token,online_code:onlinecode},function(e){outline(e),1==e.error?alert(e.message):"操作成功"===e.message&&$(".all").find(".details").eq(s).remove()}))})}),$(".all").on("click",".tianxie",function(){var s=$(this).parents(".details").find(".dliverid").html(),e=$(this).parents(".details").find(".tmjbeizhu input").val(),t=($(this).parents(".details").find(".tmjbeizhu input"),$(this));$.post(localhost+"/tuan/tuanorders/leavemsg",{oid:s,saleId:token,leavemsg:e},function(s){outline(s),"操作成功"===s.message&&(console.log(t.parents(".details").find(".tmjbeizhu input")[0].placeholder),t.parents(".details").find(".tmjbeizhu input")[0].placeholder=e,t.parents(".details").find(".tmjbeizhu input").val(""))})}),$(".all").on("click",".fahuo-geren",function(){var s=$(this).parents(".details").find(".dliverid").html(),e=$(this).siblings(".oid").text(),t=$(this).siblings(".express").find("input").val(),a=$(this).siblings(".details-ul").find("input").val(),i=$(this).parents(".details").index(),n=$(this);$.post(localhost+"/tuan/tdeliver/update_tuan",{id:e,dcode:t,dname:a,saleId:token,oid:s,online_code:onlinecode},function(e){outline(e),e.error?(alert(e.message),console.log(e)):"操作成功"===e.message&&$.post(localhost+"/tuan/tuanorders/changestate",{oid:s,state:"待收货团购订单",saleId:token,online_code:onlinecode},function(s){outline(s),s.error?alert(s.message):"操作成功"===s.message?(alert("发货成功"),n.parents(".details").eq(i).remove()):alert(s.message)})})}),$(".next").click(function(){pages++,details_.pageNumber=pages,$.post(localhost+style_,details_,function(s){outline(s),0===(content=void 0===s.data.content?s.data:s.data.content).length?($(".message").html("这已经是最后一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3),pages--,details_.pageNumber=pages,$.post(localhost+style_,details_,function(s){outline(s),content=void 0===s.data.content?s.data:s.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()})):(content=void 0===s.data.content?s.data:s.data.content,html_(content))})}),$(".last").click(function(){--pages<0?(pages=0,$(".message").html("这已经是第一页了！").fadeIn(),setTimeout(function(){$(".message").fadeOut()},1e3)):(details_.pageNumber=pages,$.post(localhost+style_,details_,function(s){outline(s),content=void 0===s.data.content?s.data:s.data.content,html_(content),0===content.length?$(".pages").hide():$(".pages").show()}))});
/*2018-01-05*/